<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="baidu-site-verification" content="codeva-OBV0UPgBod" />
    <meta name="msvalidate.01" content="B9019CE3751A15D63E78AF8679980069" />
    <meta name="description" content="åŸºç¡€çŸ¥è¯†ä¸ºä»€ä¹ˆéœ€è¦ HiveHadoop ç”Ÿæ€ç³»ç»Ÿçš„å‡ºç°ï¼Œä¸ºä»¥åˆç†çš„æˆæœ¬å¤„ç†å¤§æ•°æ®é›†æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå®ƒåŸºäº HDFSï¼ˆåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼‰å®ç°äº†ä¸€ä¸ª MapReduce ç¼–ç¨‹æ¨¡å‹ï¼Œå°†è®¡ç®—ä»»åŠ¡åˆ†æ•£åˆ°å¤šä¸ªç¡¬ä»¶æœºå™¨ä¸Šï¼Œä»è€Œé™ä½æˆæœ¬å¹¶æä¾›æ°´å¹³ä¼¸ç¼©æ€§ã€‚ ä½†æ˜¯ä»ç°æœ‰çš„æ•°æ®åŸºç¡€æ¶æ„è½¬ç§»åˆ° Hadoop ä»¥åŠä» Hadoop ä¸­è·å–æ•°æ®æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼ˆMapReduce Java APIï¼‰ï¼ŒHive çš„å‡ºç°">
<meta property="og:type" content="article">
<meta property="og:title" content="Hiveå­¦ä¹ ç¬”è®°">
<meta property="og:url" content="https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/index.html">
<meta property="og:site_name" content="Lozhu&#39;s blog">
<meta property="og:description" content="åŸºç¡€çŸ¥è¯†ä¸ºä»€ä¹ˆéœ€è¦ HiveHadoop ç”Ÿæ€ç³»ç»Ÿçš„å‡ºç°ï¼Œä¸ºä»¥åˆç†çš„æˆæœ¬å¤„ç†å¤§æ•°æ®é›†æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå®ƒåŸºäº HDFSï¼ˆåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼‰å®ç°äº†ä¸€ä¸ª MapReduce ç¼–ç¨‹æ¨¡å‹ï¼Œå°†è®¡ç®—ä»»åŠ¡åˆ†æ•£åˆ°å¤šä¸ªç¡¬ä»¶æœºå™¨ä¸Šï¼Œä»è€Œé™ä½æˆæœ¬å¹¶æä¾›æ°´å¹³ä¼¸ç¼©æ€§ã€‚ ä½†æ˜¯ä»ç°æœ‰çš„æ•°æ®åŸºç¡€æ¶æ„è½¬ç§»åˆ° Hadoop ä»¥åŠä» Hadoop ä¸­è·å–æ•°æ®æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼ˆMapReduce Java APIï¼‰ï¼ŒHive çš„å‡ºç°">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic1.zhimg.com/80/v2-749cc641eb4d5dafd085e8c23f8826aa_1440w.jpg?source=1940ef5c">
<meta property="og:image" content="https://pic2.zhimg.com/80/v2-48240f0e1e0dd33ec89100cbe2d30707_1440w.jpg?source=1940ef5c">
<meta property="article:published_time" content="2022-03-20T06:35:54.000Z">
<meta property="article:modified_time" content="2024-12-08T06:50:57.171Z">
<meta property="article:author" content="lozhu">
<meta property="article:tag" content="å¤§æ•°æ®">
<meta property="article:tag" content="Hive">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic1.zhimg.com/80/v2-749cc641eb4d5dafd085e8c23f8826aa_1440w.jpg?source=1940ef5c">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Hiveå­¦ä¹ ç¬”è®°</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XMGS491MQF"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XMGS491MQF');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Lozhu's blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="modal" class="modal">
  <span id="modal_close_btn" class="modal-close-btn">x</span>
  <img id="modal_image" class="modal-image">
  <!-- <div id="caption"></div> -->
</div>

      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="é¡¶éƒ¨" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/friends/">å‹é“¾</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">å¼€å¾€ ğŸš‡</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="ä¸Šä¸€ç¯‡" href="/2022/04/01/3762ce77035a/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡" href="/2022/03/19/8017d84950b3/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="è¿”å›é¡¶éƒ¨" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº«æ–‡ç« " href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li> -->
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&text=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&is_video=false&description=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li> -->
  <li><a class="icon" href="mailto:?subject=Hiveå­¦ä¹ ç¬”è®°&body=Check out this article: https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-reddit " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-digg " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&name=Hiveå­¦ä¹ ç¬”è®°&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&t=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li> -->
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-Hive"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦ Hive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E7%9A%84%E5%B1%80%E9%99%90"><span class="toc-number">1.2.</span> <span class="toc-text">Hive çš„å±€é™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-%E5%92%8C-Hive-%EF%BC%9A%E8%AF%8D%E9%A2%91%E7%BB%9F%E8%AE%A1%E7%AE%97%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">Java å’Œ Hive ï¼šè¯é¢‘ç»Ÿè®¡ç®—æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">Hive å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CLI-%E9%80%89%E9%A1%B9"><span class="toc-number">2.1.</span> <span class="toc-text">CLI é€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E7%9A%84%E5%B1%9E%E6%80%A7%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">2.2.</span> <span class="toc-text">Hive çš„å±æ€§å‘½åç©ºé—´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%B8%80%E6%AC%A1%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">Hive ä¸­ä½¿ç”¨ä¸€æ¬¡å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.4.</span> <span class="toc-text">ä»æ–‡ä»¶ä¸­æ‰§è¡ŒæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hiverc%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">hivercæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C-shell-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.</span> <span class="toc-text">æ‰§è¡Œ shell å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Hive-%E5%86%85%E4%BD%BF%E7%94%A8-dfs-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.7.</span> <span class="toc-text">åœ¨ Hive å†…ä½¿ç”¨ dfs å‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">æ•°æ®ç±»å‹å’Œæ–‡ä»¶æ ¼å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#byte%E3%80%81Byte%E3%80%81bit%E3%80%81%E5%AD%97%E8%8A%82"><span class="toc-number">3.1.</span> <span class="toc-text">byteã€Byteã€bitã€å­—èŠ‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">Hive ä¸­çš„æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text">é›†åˆç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89"><span class="toc-number">4.</span> <span class="toc-text">HiveQL æ•°æ®å®šä¹‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">4.1.</span> <span class="toc-text">æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.2.</span> <span class="toc-text">å¸¸è§æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8%E4%B8%8E%E5%A4%96%E9%83%A8%E8%A1%A8%EF%BC%88MANAGED-TABLE-EXTERNAL-TABLE%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨ï¼ˆMANAGED_TABLE &amp; EXTERNAL_TABLEï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8"><span class="toc-number">5.</span> <span class="toc-text">åˆ†åŒºè¡¨å’Œç®¡ç†è¡¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">å¯¹è¡¨çš„æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">7.</span> <span class="toc-text">HiveQL æ•°æ®æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.</span> <span class="toc-text">HiveQL æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="toc-number">8.1.</span> <span class="toc-text">å¸¸ç”¨å‡½æ•°ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97-SELECT"><span class="toc-number">8.2.</span> <span class="toc-text">åµŒå¥— SELECT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CASE-WHEN"><span class="toc-number">8.3.</span> <span class="toc-text">CASE WHEN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E8%BF%9B%E8%A1%8C-MapReduce"><span class="toc-number">8.4.</span> <span class="toc-text">é¿å…è¿›è¡Œ MapReduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-cast"><span class="toc-number">8.5.</span> <span class="toc-text">ç±»å‹è½¬æ¢ cast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E6%A0%B7%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.6.</span> <span class="toc-text">æŠ½æ ·æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UNION-ALL"><span class="toc-number">8.7.</span> <span class="toc-text">UNION ALL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E8%A7%86%E5%9B%BE"><span class="toc-number">9.</span> <span class="toc-text">HiveQL è§†å›¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E7%B4%A2%E5%BC%95"><span class="toc-number">10.</span> <span class="toc-text">HiveQL ç´¢å¼•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1"><span class="toc-number">11.</span> <span class="toc-text">æ¨¡å¼è®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="toc-number">11.1.</span> <span class="toc-text">åˆ†åŒºè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E9%94%AE%E5%92%8C%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-number">11.2.</span> <span class="toc-text">å”¯ä¸€é”®å’Œæ ‡å‡†åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%A4%9A%E6%AC%A1"><span class="toc-number">11.3.</span> <span class="toc-text">åŒä¸€ä»½æ•°æ®å¤„ç†å¤šæ¬¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E6%AF%8F%E4%B8%AA%E8%A1%A8%E7%9A%84%E5%88%86%E5%8C%BA"><span class="toc-number">11.4.</span> <span class="toc-text">å¯¹äºæ¯ä¸ªè¡¨çš„åˆ†åŒº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%A1%B6-%F0%9F%AA%A3"><span class="toc-number">11.5.</span> <span class="toc-text">åˆ†æ¡¶ ğŸª£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E8%A1%A8%E6%96%B0%E5%A2%9E%E5%88%97"><span class="toc-number">11.6.</span> <span class="toc-text">ä¸ºè¡¨æ–°å¢åˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%97%E5%AD%98%E5%82%A8%E8%A1%A8-%F0%9F%93%A6"><span class="toc-number">11.7.</span> <span class="toc-text">ä½¿ç”¨åˆ—å­˜å‚¨è¡¨ ğŸ“¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9-%F0%9F%97%9C%EF%B8%8F"><span class="toc-number">11.8.</span> <span class="toc-text">ä½¿ç”¨å‹ç¼© ğŸ—œï¸</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E8%AE%B0%E5%BD%95-%F0%9F%93%9D"><span class="toc-number">12.</span> <span class="toc-text">Hive å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆè®°å½• ğŸ“</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Hiveå­¦ä¹ ç¬”è®°
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">lozhu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-03-20T06:35:54.000Z" class="dt-published" itemprop="datePublished">2022-03-20</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a>
    </div>


      
    <!-- <div class="article-tag"> -->
    <div class="article-category">
        <i class="fa-solid fa-tag"></i>
        <!-- <a class="p-category" href="/tags/Hive/" rel="tag">Hive</a>, <a class="p-category" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">å¤§æ•°æ®</a> -->
        <a class="category-link" href="/tags/Hive/" rel="tag">Hive</a>, <a class="category-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">å¤§æ•°æ®</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-Hive"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Hive" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Hive"></a>ä¸ºä»€ä¹ˆéœ€è¦ Hive</h3><p>Hadoop ç”Ÿæ€ç³»ç»Ÿçš„å‡ºç°ï¼Œä¸ºä»¥åˆç†çš„æˆæœ¬å¤„ç†å¤§æ•°æ®é›†æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå®ƒåŸºäº HDFSï¼ˆåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼‰å®ç°äº†ä¸€ä¸ª MapReduce ç¼–ç¨‹æ¨¡å‹ï¼Œå°†è®¡ç®—ä»»åŠ¡åˆ†æ•£åˆ°å¤šä¸ªç¡¬ä»¶æœºå™¨ä¸Šï¼Œä»è€Œé™ä½æˆæœ¬å¹¶æä¾›æ°´å¹³ä¼¸ç¼©æ€§ã€‚</p>
<p>ä½†æ˜¯ä»ç°æœ‰çš„æ•°æ®åŸºç¡€æ¶æ„è½¬ç§»åˆ° Hadoop ä»¥åŠä» Hadoop ä¸­è·å–æ•°æ®æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼ˆMapReduce Java APIï¼‰ï¼ŒHive çš„å‡ºç°å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåŸºäº Hive å¯ä»¥æ–¹ä¾¿çš„å®ç°ç»“æ„åŒ–æ•°æ®åˆ° Hadoop æ•°æ®ä»“åº“çš„æ•°æ®è½¬ç§»ã€‚</p>
<p>Hive å°†å¤§å¤šæ•°çš„æŸ¥è¯¢è½¬åŒ–æˆ MR ä»»åŠ¡ï¼ŒHiveQL æ—¢é™ä½äº†ä½¿ç”¨éš¾åº¦ï¼Œä¹Ÿæé«˜äº† Hadoop çš„æ‰©å±•æ€§ã€‚</p>
<h3 id="Hive-çš„å±€é™"><a href="#Hive-çš„å±€é™" class="headerlink" title="Hive çš„å±€é™"></a>Hive çš„å±€é™</h3><ul>
<li>Hive é€‚ç”¨äºæ•°æ®ä¸ç»å¸¸å˜åŠ¨ï¼Œè€Œä¸”ä¸éœ€è¦ç«‹å³å¾—åˆ°æŸ¥è¯¢ç»“æœçš„æƒ…å†µã€‚</li>
<li>ç”±äº Hadoop å’Œ HDFS çš„è®¾è®¡ï¼ŒHive ä¸æ”¯æŒè¡Œçº§åˆ«çš„æ’å…¥ã€åˆ é™¤åŠæ›´æ–°ï¼Œä¸æ”¯æŒäº‹åŠ¡ã€‚</li>
<li>HiveQL ä¸ç¬¦åˆ ANSI SQL æ ‡å‡†ï¼Œå¾ˆå¤š SQL å’Œ Oracleã€MySQL å­˜åœ¨å·®å¼‚ã€‚</li>
</ul>
<h3 id="Java-å’Œ-Hive-ï¼šè¯é¢‘ç»Ÿè®¡ç®—æ³•"><a href="#Java-å’Œ-Hive-ï¼šè¯é¢‘ç»Ÿè®¡ç®—æ³•" class="headerlink" title="Java å’Œ Hive ï¼šè¯é¢‘ç»Ÿè®¡ç®—æ³•"></a>Java å’Œ Hive ï¼šè¯é¢‘ç»Ÿè®¡ç®—æ³•</h3><p>è¿™æ˜¯ã€ŠHadoopæƒå¨æŒ‡å—ã€‹ä¸­çš„ç¬¬ä¸€ç« çš„ä¾‹å­ç¨‹åºï¼Œä½¿ç”¨ Hadoop Java API å®ç°ä¸€ä¸ªç»Ÿè®¡æ–‡æœ¬æ–‡ä»¶ä¸­æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°çš„ç¨‹åºï¼Œå¯ä»¥å¸®åŠ©ç†è§£ MR åŸç†ä»¥åŠä½¿ç”¨ Hive çš„å¥½å¤„ã€‚</p>
<p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="xml">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
    &lt;artifactId&gt;hadoop-common&lt;/artifactId&gt;
    &lt;version&gt;3.2.2&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
    &lt;artifactId&gt;hadoop-hdfs&lt;/artifactId&gt;
    &lt;version&gt;3.2.2&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
    &lt;artifactId&gt;hadoop-mapreduce-client-core&lt;/artifactId&gt;
    &lt;version&gt;3.2.2&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
    &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;
    &lt;version&gt;3.2.2&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<pre><code class="java">package im.yuki.wordcount;

import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.fs.FileSystem;
import org.apache.hadoop.fs.Path;
import org.apache.hadoop.io.LongWritable;
import org.apache.hadoop.io.Text;
import org.apache.hadoop.mapreduce.Job;
import org.apache.hadoop.mapreduce.Mapper;
import org.apache.hadoop.mapreduce.Reducer;
import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;
import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;

import java.io.IOException;

/**
 * @author longkun
 * @version V1.0
 * @date 2022/3/17 11:36 PM
 * @description hadoop è¯é¢‘ç»Ÿè®¡
 */
public class WordCount &#123;

    private static final String OUTPUT_PATH = &quot;hdfs://127.0.0.1:9000/hdp/0317/wordcountoutput/&quot;;

    public static class Map extends Mapper&lt;LongWritable, Text, Text, LongWritable&gt; &#123;
        private static final LongWritable one = new LongWritable(1);

        @Override
        protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123;
            String[] words = value.toString().split(&quot; &quot;);
            Text word;
            for (String w : words) &#123;
                word = new Text(w);
                context.write(word, one);
            &#125;
        &#125;
    &#125;

    public static class Reduce extends Reducer&lt;Text, LongWritable, Text, LongWritable&gt; &#123;
        @Override
        protected void reduce(Text key, Iterable&lt;LongWritable&gt; values, Context context) throws IOException,
                InterruptedException &#123;
            int count = 0;
            for (LongWritable value : values) &#123;
                count += value.get();
            &#125;
            context.write(key, new LongWritable(count));
        &#125;
    &#125;

    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException &#123;
        // è®¾ç½®ç¯å¢ƒå˜é‡ HADOOP_USER_NAME
        System.setProperty(&quot;HADOOP_USER_NAME&quot;, &quot;longkun&quot;);
        // è¯»å–é…ç½®æ–‡ä»¶
        Configuration configuration = new Configuration();
        configuration.set(&quot;fs.defaultFS&quot;, &quot;hdfs://127.0.0.1:9000&quot;);
        configuration.set(&quot;yarn.resourcemanager.hostname&quot;, &quot;hdp01&quot;);

        FileSystem fileSystem = FileSystem.get(configuration);

        Job job = Job.getInstance(configuration, &quot;WordCount&quot;);
        job.setJarByClass(WordCount.class);
        job.setMapperClass(Map.class);
        job.setCombinerClass(Reduce.class);
        job.setReducerClass(Reduce.class);

        job.setMapOutputKeyClass(Text.class);
        job.setMapOutputValueClass(LongWritable.class);
        job.setOutputKeyClass(Text.class);
        job.setOutputKeyClass(LongWritable.class);
        job.setNumReduceTasks(2);

        Path outputPath = new Path(OUTPUT_PATH);
        FileInputFormat.setInputPaths(job, new Path(&quot;hdfs://127.0.0.1:9000/hdp/0317/wordcountinput/&quot;));
        FileOutputFormat.setOutputPath(job, outputPath);

        if (fileSystem.exists(outputPath)) &#123;
            fileSystem.delete(outputPath, true);
        &#125;
        System.exit(job.waitForCompletion(true) ? 0 : 1);
    &#125;
&#125;
</code></pre>
<p>âš ï¸ <em>è¿è¡Œæ—¶ä¼šæç¤º log4j çš„é…ç½®æœ‰è¯¯ï¼Œè¿è¡Œç¨‹åºå‰éœ€è¦å°† $HADOOP_HOME&#x2F;etc&#x2F;hadoop&#x2F;log4j.properties æ–‡ä»¶å¤åˆ¶åˆ° src&#x2F;main&#x2F;resouces ç›®å½•ä¸‹ã€‚</em></p>
<p>å°†éœ€è¦ç»Ÿè®¡çš„æ–‡æœ¬æ–‡ä»¶ä¸Šä¼ åˆ° hdfs:&#x2F;&#x2F;127.0.0.1:9000&#x2F;hdp&#x2F;0317&#x2F;wordcountinput ç›®å½•ä¸‹ã€‚</p>
<p>åœ¨ Hive ä¸­ç»Ÿè®¡è¯é¢‘ï¼š</p>
<p>1ã€å°†æ–‡æœ¬æ–‡ä»¶ä¸Šä¼ åˆ° hdfs ä¸­</p>
<pre><code class="sh">hdfs dfs -put ~/Desktop/wordcount.txt /hdp/0317/wordcountinput
</code></pre>
<p>2ã€å°† hdfs ä¸­çš„æ•°æ®æ’å…¥åˆ° Hive è¡¨ä¸­</p>
<pre><code class="sql">&gt; load data inpath &#39;/hdp/0317/wordcountinput/wordcount.txt&#39; docs
</code></pre>
<p>3ã€HiveQL æŸ¥è¯¢ç»“æœ</p>
<pre><code class="sql">select tmp.word, count(*) as cnt
from (
    select explode(split(line, &#39; &#39;)) as word
  from docs
) tmp
group by tmp.word
order by cnt;
</code></pre>
<h2 id="Hive-å‘½ä»¤"><a href="#Hive-å‘½ä»¤" class="headerlink" title="Hive å‘½ä»¤"></a>Hive å‘½ä»¤</h2><p>æ‰§è¡Œ <code>hive --help</code> æŸ¥çœ‹ Hive å‘½ä»¤åˆ—è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>cli</td>
<td>å‘½ä»¤è¡Œç•Œé¢</td>
<td>è¿›å…¥å‘½ä»¤è¡Œã€‚</td>
</tr>
<tr>
<td>hwi</td>
<td>Hive Web ç•Œé¢</td>
<td>å¯ä»¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å’Œå…¶ä»–å‘½ä»¤çš„ç®€å• Web ç•Œé¢ã€‚</td>
</tr>
<tr>
<td>metastore</td>
<td></td>
<td>å¯åŠ¨ä¸€ä¸ªæ‰©å±•çš„å…ƒæ•°æ®æœåŠ¡ï¼Œå¯ä»¥ä¾›å¤šå®¢æˆ·ç«¯ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td>rcfilecat</td>
<td></td>
<td>ä¸€ä¸ªå¯ä»¥æ‰“å°å‡º RCFile æ ¼å¼æ–‡ä»¶å†…å®¹çš„å·¥å…·</td>
</tr>
</tbody></table>
<h3 id="CLI-é€‰é¡¹"><a href="#CLI-é€‰é¡¹" class="headerlink" title="CLI é€‰é¡¹"></a>CLI é€‰é¡¹</h3><p>ä½¿ç”¨å‘½ä»¤ <code>hive --help --service cli</code> æŸ¥çœ‹ cli é€‰é¡¹ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>-d | â€“define</td>
<td>å˜é‡æ›¿æ¢</td>
</tr>
<tr>
<td>-e</td>
<td>æ‰§è¡Œå‘½ä»¤è¡Œä¸­çš„ SQL</td>
</tr>
<tr>
<td>-f</td>
<td>ä»æ–‡ä»¶ä¸­æ‰§è¡Œ SQL</td>
</tr>
<tr>
<td>-H</td>
<td>æ‰“å°å¸®åŠ©ä¿¡æ¯</td>
</tr>
<tr>
<td>-h</td>
<td>è¿æ¥ä¸»æœºå</td>
</tr>
<tr>
<td>-i</td>
<td>åˆå§‹åŒ– SQL æ–‡ä»¶</td>
</tr>
<tr>
<td>-p</td>
<td>è¿æ¥ç«¯å£</td>
</tr>
<tr>
<td>-S | -silent</td>
<td>äº¤äº’å¼å‘½ä»¤è¡Œä¸‹å®‰é™æ¨¡å¼</td>
</tr>
<tr>
<td>-v | â€“verbose</td>
<td>è¾“å‡ºè°ƒè¯•ä¿¡æ¯</td>
</tr>
</tbody></table>
<h3 id="Hive-çš„å±æ€§å‘½åç©ºé—´"><a href="#Hive-çš„å±æ€§å‘½åç©ºé—´" class="headerlink" title="Hive çš„å±æ€§å‘½åç©ºé—´"></a>Hive çš„å±æ€§å‘½åç©ºé—´</h3><table>
<thead>
<tr>
<th>å‘½åç©ºé—´</th>
<th>æƒé™</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>hivevar</td>
<td>å¯è¯»å¯å†™</td>
<td>ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</td>
</tr>
<tr>
<td>hiveconf</td>
<td>å¯è¯»å¯å†™</td>
<td>Hive ç›¸å…³çš„é…ç½®</td>
</tr>
<tr>
<td>system</td>
<td>å¯è¯»å¯å†™</td>
<td>Java å®šä¹‰çš„é…ç½®å±æ€§</td>
</tr>
<tr>
<td>env</td>
<td>åªå¯è¯»</td>
<td>Shell ç¯å¢ƒå®šä¹‰çš„ç¯å¢ƒå˜é‡</td>
</tr>
</tbody></table>
<p>å‡ ä¸ªä¾‹å­ğŸŒ°ï¼š</p>
<pre><code class="shell"># hivevar --define &amp; set
$ hive --define foo=bar;

&gt; set foo;
&gt; foo=bar;

&gt; set hivevar:foo=bar2;

&gt; create table tbl_0318(int i, $&#123;foo&#125; string);
&gt; desc tbl_0318;
OK
i                   	int
bar2                	string


# hiveconf
# æ˜¾ç¤ºå½“å‰æ‰€åœ¨åº“å
&gt; set hiveconf hive.cli.print.current.db=true;

# system
&gt; set system:user.name
system:user.name=longkun

# env
&gt; set env:HOME
env:HOME=/Users/longkun
</code></pre>
<h3 id="Hive-ä¸­ä½¿ç”¨ä¸€æ¬¡å‘½ä»¤"><a href="#Hive-ä¸­ä½¿ç”¨ä¸€æ¬¡å‘½ä»¤" class="headerlink" title="Hive ä¸­ä½¿ç”¨ä¸€æ¬¡å‘½ä»¤"></a>Hive ä¸­ä½¿ç”¨ä¸€æ¬¡å‘½ä»¤</h3><p>âœ… å¦‚æœå¸Œæœ›ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ç»“æŸåç«‹å³é€€å‡º cliï¼Œå¯ä»¥ä½¿ç”¨ -e é€‰é¡¹ï¼š</p>
<pre><code class="shell">$ hive --service cli -e &quot;select * from db_0316.docs where 1 = 1&quot;;
</code></pre>
<p>âœ… è¿˜å¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="shell">$ hive --service cli -e &quot;select * from db_0316.docs where 1 = 1&quot; &gt; ~/Desktop/hive_tmp_result.txt
</code></pre>
<p>âœ… å½“è®°ä¸æ¸…æ¥šæŸä¸ªå±æ€§åæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ grep ï¼š</p>
<pre><code class="shell">$ hive -S -e &quot;set&quot; | grep current.db
hive.cli.print.current.db=false

$ hive -S -e &quot;set&quot; | grep warehouse
hive.metastore.warehouse.dir=/user/hive/warehouse
</code></pre>
<h3 id="ä»æ–‡ä»¶ä¸­æ‰§è¡ŒæŸ¥è¯¢"><a href="#ä»æ–‡ä»¶ä¸­æ‰§è¡ŒæŸ¥è¯¢" class="headerlink" title="ä»æ–‡ä»¶ä¸­æ‰§è¡ŒæŸ¥è¯¢"></a>ä»æ–‡ä»¶ä¸­æ‰§è¡ŒæŸ¥è¯¢</h3><p>å¯ä»¥ä½¿ç”¨ -f é€‰é¡¹ä»æ–‡ä»¶ä¸­æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ–‡ä»¶å°½é‡ä½¿ç”¨ .q æˆ–è€… .hql åç¼€ã€‚</p>
<p>æ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ query.hqlï¼š</p>
<pre><code>select *
from db_0316.docs
where 1 = 1;
</code></pre>
<pre><code class="shell"># æ‰§è¡ŒæŸ¥è¯¢
$ hive -S -f query.hql

# åœ¨ cli ä¸­å¯ä»¥ä½¿ç”¨ source å‘½ä»¤æ¥æ‰§è¡Œæ–‡ä»¶ä¸­çš„æŸ¥è¯¢è¯­å¥
&gt; source ~/Documents/Hive/query.hql
</code></pre>
<h3 id="hivercæ–‡ä»¶"><a href="#hivercæ–‡ä»¶" class="headerlink" title="hivercæ–‡ä»¶"></a>hivercæ–‡ä»¶</h3><p>-i é€‰é¡¹æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯æ¬¡ CLI å¯åŠ¨æ—¶ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚Hive ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾ .hiverc æ–‡ä»¶å¹¶æ‰§è¡Œã€‚ç¼–è¾‘ $HIVE_HOME&#x2F;.hiverc æ–‡ä»¶ï¼Œæ·»åŠ å‡ ä¸ªæ¯”è¾ƒå®ç”¨çš„å˜é‡ï¼ˆâš ï¸ åˆ†å·æ˜¯å¿…é¡»çš„ï¼‰ï¼š</p>
<pre><code>set hive.cli.print.current.db=true;
set hive.cli.print.header=true;
set hive.exec.mode.local.auto=true;
</code></pre>
<p>âœ… <em>ä½¿ç”¨ tab é”®å¯ä»¥è¡¥å…¨å…³é”®å­—æˆ–è€…å‡½æ•°åã€‚</em></p>
<h3 id="æ‰§è¡Œ-shell-å‘½ä»¤"><a href="#æ‰§è¡Œ-shell-å‘½ä»¤" class="headerlink" title="æ‰§è¡Œ shell å‘½ä»¤"></a>æ‰§è¡Œ shell å‘½ä»¤</h3><p>æ— éœ€é€€å‡º cli å³å¯æ‰§è¡Œç®€å•çš„ shell å‘½ä»¤ï¼Œåªéœ€è¦åœ¨ shell å‘½ä»¤å‰åŠ ä¸Š ! ï¼Œå¹¶ä¸”ä»¥ ; ç»“å°¾ã€‚</p>
<pre><code class="shell">hive (default)&gt; !pwd;
/Users/longkun
</code></pre>
<h3 id="åœ¨-Hive-å†…ä½¿ç”¨-dfs-å‘½ä»¤"><a href="#åœ¨-Hive-å†…ä½¿ç”¨-dfs-å‘½ä»¤" class="headerlink" title="åœ¨ Hive å†…ä½¿ç”¨ dfs å‘½ä»¤"></a>åœ¨ Hive å†…ä½¿ç”¨ dfs å‘½ä»¤</h3><p>ç”¨æˆ·å¯ä»¥åœ¨ cli ä¸­æ‰§è¡Œ Hadoop  çš„ dfs å‘½ä»¤ï¼Œåªéœ€è¦å°† hdfs å»æ‰ã€‚</p>
<pre><code class="shell">hive (default)&gt; dfs -ls /;
Found 3 items
drwxr-xr-x   - longkun supergroup          0 2022-03-17 23:54 /hdp
drwx-wx-wx   - longkun supergroup          0 2022-03-18 00:52 /tmp
drwxr-xr-x   - longkun supergroup          0 2022-03-16 21:50 /user
</code></pre>
<p><em>æ®è¯´è¿™ç§æ–¹å¼æ¯”åœ¨ bash shell ä¸­æ‰§è¡Œ hdfs dfs â€¦ æ›´é«˜æ•ˆï¼Œå› ä¸ºåè€…ä¼šæ¯æ¬¡å¯åŠ¨ä¸€ä¸ª JVM å®ä¾‹ï¼Œè€Œ Hive ä¼šåœ¨åŒä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œã€‚</em></p>
<h2 id="æ•°æ®ç±»å‹å’Œæ–‡ä»¶æ ¼å¼"><a href="#æ•°æ®ç±»å‹å’Œæ–‡ä»¶æ ¼å¼" class="headerlink" title="æ•°æ®ç±»å‹å’Œæ–‡ä»¶æ ¼å¼"></a>æ•°æ®ç±»å‹å’Œæ–‡ä»¶æ ¼å¼</h2><h3 id="byteã€Byteã€bitã€å­—èŠ‚"><a href="#byteã€Byteã€bitã€å­—èŠ‚" class="headerlink" title="byteã€Byteã€bitã€å­—èŠ‚"></a>byteã€Byteã€bitã€å­—èŠ‚</h3><ul>
<li><p>bit</p>
<pre><code>bit å³æ˜¯ä½ï¼Œè¡¨ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼Œ0 æˆ– 1ã€‚
</code></pre>
</li>
<li><p>byte</p>
<pre><code>Java çš„åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå­˜å‚¨æ•´å½¢ï¼ŒByte æ˜¯å…¶åŒ…è£…ç±»ã€‚
</code></pre>
</li>
<li><p>Byte</p>
<pre><code>Byte è¡¨ç¤ºå­—èŠ‚ï¼Œ1 Byte = 8 bit
</code></pre>
<p>Hive ä¸­çš„æ•°æ®ç±»å‹éƒ½æ¥æºäº Java ä¸­çš„æ•°æ®ç±»å‹ã€‚</p>
</li>
</ul>
<h3 id="Hive-ä¸­çš„æ•°æ®ç±»å‹"><a href="#Hive-ä¸­çš„æ•°æ®ç±»å‹" class="headerlink" title="Hive ä¸­çš„æ•°æ®ç±»å‹"></a>Hive ä¸­çš„æ•°æ®ç±»å‹</h3><table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>é•¿åº¦</th>
<th>ä¾‹å­ğŸŒ°</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1byte æœ‰ç¬¦å·æ•´æ•°</td>
<td>20</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2byte æœ‰ç¬¦å·æ•´æ•°</td>
<td>20</td>
</tr>
<tr>
<td>INT</td>
<td>4byte æœ‰ç¬¦å·æ•´æ•°</td>
<td>20</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8byte æœ‰ç¬¦å·æ•´æ•°</td>
<td>20</td>
</tr>
<tr>
<td>BOOLEAN</td>
<td>boolç±»å‹ï¼Œtrue æˆ–è€… false</td>
<td>TRUE</td>
</tr>
<tr>
<td>FLOAT</td>
<td>å•ç²¾åº¦æµ®ç‚¹å‹</td>
<td>3.1315</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>åŒç²¾åº¦æµ®ç‚¹å‹</td>
<td>3.1415</td>
</tr>
<tr>
<td>STRING</td>
<td>å­—ç¬¦åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·</td>
<td>â€˜zhang sanâ€™  â€œwang erâ€</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>æ•´æ•°ã€æµ®ç‚¹æˆ–è€…å­—ç¬¦ä¸²</td>
<td>Unixæ–°çºªå…ƒç§’ï¼ŒUnixæ–°çºªå…ƒç§’åŠçº³ç§’ï¼ŒJDBCæ—¶é—´æ ¼å¼</td>
</tr>
<tr>
<td>BINARY</td>
<td>å­—èŠ‚æ•°ç»„</td>
<td>å’Œå…³ç³»å‹æ•°æ®åº“ä¸­ VARNIBARYç±»ä¼¼ï¼Ÿæ²¡çœ‹æ‡‚</td>
</tr>
</tbody></table>
<p><em>å•ç²¾åº¦å’ŒåŒç²¾åº¦æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå•å’ŒåŒæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</em></p>
<p>å•ç²¾åº¦ï¼š1ä½ç¬¦å·ï¼Œ8ä½æŒ‡æ•°ï¼Œ23ä½å°æ•°ã€‚</p>
<p><img src="https://pic1.zhimg.com/80/v2-749cc641eb4d5dafd085e8c23f8826aa_1440w.jpg?source=1940ef5c" alt="å•ç²¾åº¦è¡¨ç¤º"></p>
<p>åŒç²¾åº¦ï¼š1ä½ç¬¦å·ï¼Œ11ä½æŒ‡æ•°ï¼Œ52ä½å°æ•°ã€‚</p>
<p><img src="https://pic2.zhimg.com/80/v2-48240f0e1e0dd33ec89100cbe2d30707_1440w.jpg?source=1940ef5c" alt="åŒç²¾åº¦è¡¨ç¤º"></p>
<p>è¿˜æ˜¯æ²¡è§£é‡Š å• å’Œ åŒ çš„æ„æ€ã€‚ã€‚</p>
<h3 id="é›†åˆç±»å‹"><a href="#é›†åˆç±»å‹" class="headerlink" title="é›†åˆç±»å‹"></a>é›†åˆç±»å‹</h3><blockquote>
<p>Hive ä¸­æ”¯æŒ structã€map å’Œ array é›†åˆæ•°æ®ç±»å‹ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>æè¿°</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>STRUCT</td>
<td>ä¸å¯¹è±¡ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡ . è®¿é—®å…ƒç´ å†…å®¹</td>
<td>struct{first string, last string}</td>
</tr>
<tr>
<td>MAP</td>
<td>é”®å€¼å¯¹</td>
<td>map(â€˜firstâ€™, â€˜johnâ€™, â€˜lastâ€™, â€˜doeâ€™)</td>
</tr>
<tr>
<td>ARRAY</td>
<td>å…·æœ‰ç›¸åŒç±»å‹çš„å˜é‡é›†åˆ</td>
<td>array(â€˜firstâ€™, â€˜lastâ€™)</td>
</tr>
</tbody></table>
<p>å»ºè¡¨è¯­å¥ï¼š</p>
<pre><code class="sql">drop table if exists db_0320.tbl_person;
drop table if exists db_0320.person;
create table db_0320.tbl_person (
    name string comment &#39;name&#39;,
    age float comment &#39;age&#39;,
    location string comment &#39;location&#39;,
    friends array&lt;string&gt; comment &#39;friends&#39;,
    score map&lt;string, double&gt; comment &#39;score&#39;,
    address struct&lt;number: tinyint, street: string, city: string&gt;
)
row format delimited
fields terminated by &#39;\001&#39;
collection terminated by &#39;\002&#39;
map keys terminated by &#39;\003&#39;
lines terminated by &#39;\n&#39;
stored as textfile;
</code></pre>
<h2 id="HiveQL-æ•°æ®å®šä¹‰"><a href="#HiveQL-æ•°æ®å®šä¹‰" class="headerlink" title="HiveQL æ•°æ®å®šä¹‰"></a>HiveQL æ•°æ®å®šä¹‰</h2><h3 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h3><ul>
<li>HiveQL å’Œ MySQL æ¯”è¾ƒæ¥è¿‘ï¼Œä½†ä¹Ÿæœ‰è¾ƒå¤§å·®å¼‚</li>
<li>Hive ä¸æ”¯æŒè¡Œçº§æ’å…¥ã€æ›´æ–°åŠåˆ é™¤æ“ä½œ</li>
<li>Hive ä¸æ”¯æŒäº‹åŠ¡</li>
<li>å¤§å¤šæ•°æƒ…å†µä¸‹ HiveQL å’Œå…¶ä»– SQL å¾ˆåƒ</li>
<li>æŸ¥è¯¢ã€åˆ†ç»„ã€è¿‡æ»¤åŠè¿æ¥</li>
</ul>
<h3 id="å¸¸è§æŸ¥è¯¢"><a href="#å¸¸è§æŸ¥è¯¢" class="headerlink" title="å¸¸è§æŸ¥è¯¢"></a>å¸¸è§æŸ¥è¯¢</h3><pre><code class="sql">-- æ–°å»ºæ•°æ®åº“
&gt; create database db_test;
&gt; create database if not exists db_test;

-- æŸ¥çœ‹æ‰€æœ‰çš„åº“
&gt; show databases;
-- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼
-- æŸ¥è¯¢ä»¥ db_ å¼€å¤´ çš„æ‰€æœ‰æ•°æ®åº“
&gt; show databases like &#39;db_*&#39;

-- æŸ¥çœ‹åº“é‡Œçš„è¡¨
&gt; show tables from db_test;

-- åˆ åº“ï¼ˆåˆ åº“ä¹‹å‰å¿…é¡»å…ˆåˆ é™¤åº“ä¸­çš„è¡¨ï¼Œæˆ–è€…ä½¿ç”¨å…³é”®å­— CASCADEï¼‰
&gt; drop database if exists db_test cascade;

-- æŸ¥çœ‹è¡¨å±æ€§
&gt; desc formatted tbl_test;
-- å¦‚æœåªæƒ³æŸ¥çœ‹æŸä¸€åˆ—çš„ä¿¡æ¯ï¼Œåªéœ€åœ¨è¡¨ååå¢åŠ è¿™ä¸€åˆ—çš„åç§°å³å¯ï¼ˆäº²æµ‹æŠ¥é”™ï¼šmissing EOF at &#39;.&#39; near &#39;tbl_person&#39;ï¼‰
&gt; describe db_0320.tbl_person.score;


-- æ‹·è´ä¸€å¼ å·²å­˜åœ¨çš„è¡¨
&gt; create table if not exists tbl_test1 like tbl_test;
</code></pre>
<h3 id="å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨ï¼ˆMANAGED-TABLE-EXTERNAL-TABLEï¼‰"><a href="#å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨ï¼ˆMANAGED-TABLE-EXTERNAL-TABLEï¼‰" class="headerlink" title="å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨ï¼ˆMANAGED_TABLE &amp; EXTERNAL_TABLEï¼‰"></a>å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨ï¼ˆMANAGED_TABLE &amp; EXTERNAL_TABLEï¼‰</h3><p>ä½¿ç”¨ EXTERNAL åˆ›å»ºçš„è¡¨æ˜¯å¤–éƒ¨è¡¨ï¼Œå¦åˆ™å°±æ˜¯å†…éƒ¨è¡¨ã€‚å†…éƒ¨è¡¨é»˜è®¤å­˜å‚¨åœ¨ user&#x2F;hive&#x2F;warehouse&#x2F;ä¸‹ï¼Œ å½“åˆ é™¤ä¸€ä¸ªè¡¨æ—¶ï¼ŒHive ä¼šåˆ é™¤è¯¥ç›®å½•ä¸‹å­˜å‚¨çš„æ•°æ®ï¼›è€Œåˆ é™¤å¤–éƒ¨è¡¨æ—¶ï¼Œåªä¼šåˆ é™¤è¡¨çš„å…ƒæ•°æ®ï¼Œä¸ä¼šåˆ é™¤è¡¨æ•°æ®ã€‚ä¸¥æ ¼è¯´ï¼ŒHive ç®¡ç†ç€è¿™ä¹ˆç›®å½•å’Œæ–‡ä»¶ï¼Œä½†æ˜¯ä¸å¯¹å…¶æ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒã€‚</p>
<p>å¤–éƒ¨è¡¨ç¤ºä¾‹ï¼š</p>
<p>1ã€å…ˆå»ºç«‹ä¸€ä¸ªç›®å½•ï¼Œå­˜æ”¾å¤–éƒ¨è¡¨è¦æ“ä½œçš„æ•°æ®</p>
<pre><code class="shell">&gt; dfs -mkdir /hdp/0322
</code></pre>
<p>2ã€å»ºè¡¨å¹¶æŒ‡å‘å¤–éƒ¨è¡¨ç©ºé—´</p>
<pre><code class="shell">drop table if exists db_0320.ex_tbl_student;

create external table if not exists db_0320.ex_tbl_student (
    name string comment &#39;name&#39;,
    age float comment &#39;age&#39;,
    class string comment &#39;class&#39;
)
row format
delimited fields terminated by &#39;,&#39;
location &#39;/hdp/0322/&#39;;
</code></pre>
<p>3ã€å‡†å¤‡æ•°æ®å¹¶ä¸Šä¼ è‡³ HDFS</p>
<pre><code class="shell">&gt; dfs -put ~/Documents/ex_tbl_student.txt /hdp/0323/
</code></pre>
<p>æ–‡ä»¶å†…å®¹ï¼š</p>
<pre><code>zhangsan,12,ä¸€ç­
lisi,14,äºŒç­
wangwu,16,ä¸‰ç­
</code></pre>
<p>4ã€å°†æ•°æ®å¯¼å…¥å¤–éƒ¨è¡¨ä¸­</p>
<pre><code class="shell">&gt; load data inpath &#39;/hdp/0323/ex_tbl_student.txt&#39; overwrite into table db_0320.ex_tbl_student;
</code></pre>
<p>5ã€ç¡®è®¤æ•°æ®åŠæ“ä½œ</p>
<h2 id="åˆ†åŒºè¡¨å’Œç®¡ç†è¡¨"><a href="#åˆ†åŒºè¡¨å’Œç®¡ç†è¡¨" class="headerlink" title="åˆ†åŒºè¡¨å’Œç®¡ç†è¡¨"></a>åˆ†åŒºè¡¨å’Œç®¡ç†è¡¨</h2><p>åˆ†åŒºå°†æ•°æ®åˆ†æ•£åœ¨å¤šä¸ªç›®å½•ä¸‹ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p>å¦‚æœè¡¨ä¸­æ•°æ®æˆ–è€…åˆ†åŒºä¸­çš„æ•°æ®é‡å·¨å¤§ï¼Œæ‰§è¡Œä¸€ä¸ªåŒ…å«æ‰€æœ‰åˆ†åŒºçš„æŸ¥è¯¢ä¼šå‡ºå‘å·¨å¤§çš„ MR ä»»åŠ¡ï¼Œå¯ä»¥å°† <code>hive.mapred.mode=strict</code> è®¾ç½®æˆä¸¥æ ¼æ¨¡å¼ç¦æ­¢æäº¤ä»»åŠ¡ã€‚</p>
<p>åˆ›å»ºåˆ†åŒºè¡¨ï¼š</p>
<pre><code class="sql">drop table if exists db_0322.tbl_student;

create table if not exists db_0322.tbl_student (
    name string comment &#39;name&#39;,
    age float comment &#39;age&#39;,
    class string comment &#39;class&#39;
)
partitioned by (grade string comment &#39;grade&#39;);
</code></pre>
<p>æŸ¥çœ‹åˆ†åŒºï¼š</p>
<pre><code class="shell">&gt; desc partitions db_0322.tbl_student;
</code></pre>
<p>å¯¼å…¥æ•°æ®è‡³åˆ†åŒºè¡¨ï¼š</p>
<pre><code class="sh">&gt; load data inpath &#39;tbl_student.txt&#39; overwrite into table tbl_student partition (grade=&#39;grade2&#39;);
</code></pre>
<p>ä¸ºå¤–éƒ¨åˆ†åŒºè¡¨å¢åŠ ä¸€ä¸ªåˆ†åŒºï¼š</p>
<pre><code class="sql">&gt; alter table log add partition(year=2012, month=1, day=1);
</code></pre>
<h2 id="å¯¹è¡¨çš„æ“ä½œ"><a href="#å¯¹è¡¨çš„æ“ä½œ" class="headerlink" title="å¯¹è¡¨çš„æ“ä½œ"></a>å¯¹è¡¨çš„æ“ä½œ</h2><p>åˆ é™¤è¡¨ï¼š</p>
<pre><code class="sql">&gt; drop table if exists db_0323.tbl_test;
</code></pre>
<p><em>å¯ä»¥äº†è§£ä¸‹ Hive çš„å›æ”¶ç«™åŠŸèƒ½ã€‚</em></p>
<p>ä¿®æ”¹è¡¨ï¼šå¯ä»¥ä½¿ç”¨ alter table è¯­å¥ä¿®æ”¹è¡¨ï¼Œè¿™ç§æ–¹å¼ä¼š<strong>ä¿®æ”¹è¡¨çš„å…ƒæ•°æ®ï¼Œä¸ä¼šä¿®æ”¹æ•°æ®æœ¬èº«ã€‚</strong></p>
<pre><code class="sql">-- é‡å‘½åè¡¨
&gt; alter table tbl_test rename to tbl_test1;

-- å¢åŠ åˆ†åŒºï¼Œç»™æ²¡æœ‰åˆ†åŒºçš„è¡¨æ·»åŠ åˆ†åŒºä¼šæŠ¥é”™
&gt; alter table tbl_test add if not exists partition (city=&#39;Beijing&#39;);

-- åˆ é™¤åˆ†åŒº
&gt; alter table tbl_test2 drop if exists partition (city = &#39;Beijing&#39;);

-- ä¿®æ”¹å­—æ®µ
&gt; alter table tbl_test2 change column name username string comment &#39;username&#39; after column1;

-- æ–°å¢ä¸€ä¸ªå­—æ®µ
&gt; alter table tbl_test1 add columns (age float comment &#39;age&#39;);

-- ä¿®æ”¹è¡¨å±æ€§
&gt; alter table tbl_test1 set tblproperties (&#39;note&#39;=&#39;test note....&#39;)

-- æ‰§è¡Œé’©å­ï¼Œå½“å¾€è¡¨ä¸­å†™å…¥æ•°æ®æ—¶è§¦å‘æ‰§è¡Œ
&gt; alter table tbl_test touch partition(year=2021, month=12, day=1);

-- å°†åˆ†åŒºå†…çš„æ–‡ä»¶æ‰“åŒ…æˆ Hadoop å‹ç¼©åŒ…ï¼ˆHARï¼‰ï¼Œä½¿ç”¨ unarchive åå‘æ“ä½œ
&gt; alter table ... archive partition (year, month, day);

-- é˜²æ­¢åˆ†åŒºè¢«ä¿®æ”¹æˆ–åˆ é™¤ï¼ˆæŠ¥é”™ï¼‰
&gt; alter table tbl_test partition (year=2021, month=10, day=1) enable no_drop;
</code></pre>
<h2 id="HiveQL-æ•°æ®æ“ä½œ"><a href="#HiveQL-æ•°æ®æ“ä½œ" class="headerlink" title="HiveQL æ•°æ®æ“ä½œ"></a>HiveQL æ•°æ®æ“ä½œ</h2><p>Hive ä¸æ”¯æŒè¡Œçº§æ•°æ®æ’å…¥ã€æ›´æ–°åŠåˆ é™¤ï¼Œåªèƒ½é€šè¿‡å¤§æ‰¹é‡çš„æ–¹å¼å°†æ•°æ®å¯¼å…¥è¡¨ä¸­ã€‚</p>
<pre><code class="sql">&gt; load data local inpath &#39;$&#123;env:HOME&#125;/data&#39; overwrite into table tbl_test partition (year = 2022, month = 3, day = 22);
</code></pre>
<p><em>local è¡¨ç¤ºæœ¬åœ°ç›®å½•ï¼Œå¦‚æœä¸åŠ  local åˆ™è¡¨ç¤º hdfs ä¸Šçš„æ–‡ä»¶ã€‚</em></p>
<p>Hive ä¸ä¼šæ ¡éªŒå¯¼å…¥çš„æ•°æ®å’Œè¡¨çš„æ¨¡å¼æ˜¯å¦åŒ¹é…ï¼Œä½†æ˜¯ä¼šæ ¡éªŒæ–‡ä»¶æ ¼å¼æ˜¯å¦å’Œè¡¨çš„å®šä¹‰ä¸€è‡´ã€‚</p>
<p>é€šè¿‡æŸ¥è¯¢å‘è¡¨ä¸­å¯¼å…¥æ•°æ®ï¼š</p>
<pre><code class="sql">use db_0323;

from tbl_test3_tmp tmp
insert overwrite table tbl_test3
    partition (city = &#39;Beijing&#39;)
    select name where tmp.city = &#39;Beijing&#39;
insert overwrite table tbl_test3
    partition (city = &#39;Tianjin&#39;)
    select name where tmp.city = &#39;Tianjin&#39;
insert overwrite table tbl_test3
    partition (city = &#39;Tianjing&#39;)
    select name where tmp.city = &#39;Tianjing&#39;;
</code></pre>
<p>å¦‚æœä¸€ä¸ªåˆ†åŒºä¸€ä¸ªåˆ†åŒºçš„æŸ¥å‡ºæ¥å†å¯¼å…¥çš„è¯ï¼Œä¼šéå¸¸ç¹çï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€åˆ†åŒºæ’å…¥æ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<pre><code class="sql">use db_0323;

insert overwrite table tbl_test3
select name, city
from tbl_test3_tmp;
</code></pre>
<p><em>æœ€åçš„å‡ åˆ—é¡ºåºè¦å’Œåˆ†åŒºå­—æ®µä¸€è‡´ï¼ŒHive æ ¹æ®åˆ—ä½ç½®æ¥ç¡®å®šåˆ†åŒºå­—æ®µï¼Œè€Œä¸æ˜¯åç§°ã€‚å¹¶ä¸”é™æ€åˆ†åŒºå­—æ®µå¿…é¡»ä½äºåŠ¨æ€åˆ†åŒºå­—æ®µä¹‹å‰ã€‚</em></p>
<p><code>dfs -ls /user/hive/warehouse/db_0323.db/tbl_test3</code> æŸ¥çœ‹åˆ†åŒºï¼š</p>
<pre><code>Found 3 items
drwxr-xr-x   - longkun supergroup          0 2022-03-24 23:56 /user/hive/warehouse/db_0323.db/tbl_test3/city=Beijing
drwxr-xr-x   - longkun supergroup          0 2022-03-24 23:56 /user/hive/warehouse/db_0323.db/tbl_test3/city=Tianjin
drwxr-xr-x   - longkun supergroup          0 2022-03-24 23:56 /user/hive/warehouse/db_0323.db/tbl_test3/city=Tianjing
</code></pre>
<p>åŠ¨æ€åˆ†åŒºåŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ã€‚å¼€å¯åï¼Œé»˜è®¤ä»¥â€œä¸¥æ ¼â€æ¨¡å¼æ‰§è¡Œï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œè¦æ±‚è‡³å°‘æœ‰ä¸€åˆ—å­—æ®µæ˜¯é™æ€åˆ†åŒºï¼Œæœ‰åŠ©äºé˜²æ­¢å› è®¾è®¡é”™è¯¯å¯¼è‡´äº§ç”Ÿå¤§é‡çš„åˆ†åŒºã€‚</p>
<p>åŠ¨æ€åˆ†åŒºç›¸å…³å±æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§åç§°</th>
<th>ç¼ºçœå€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>hive.exec.dynamic.partition</td>
<td>false</td>
<td>è®¾ç½®æˆ trueï¼Œå¼€å¯åŠ¨æ€åˆ†åŒºåŠŸèƒ½</td>
</tr>
<tr>
<td>hive.exec.dynamic.partition.mode</td>
<td>strict</td>
<td>è®¾ç½®æˆ no strictï¼Œå…è®¸æ‰€æœ‰åˆ—éƒ½æ˜¯åŠ¨æ€åˆ†åŒº</td>
</tr>
<tr>
<td>hive.exec.max.dynamic.partitions.pernode</td>
<td>100</td>
<td>æ¯ä¸ª mapper å’Œ reducer å¯ä»¥åˆ›å»ºçš„æœ€å¤§åˆ†æ•°ï¼Œè¶…è¿‡ä¼šæŠ¥é”™</td>
</tr>
<tr>
<td>hive.exec.max.dynamic.partitions</td>
<td>1000</td>
<td>ä¸€ä¸ªåŠ¨æ€åˆ†åŒºè¯­å¥å¯ä»¥åˆ›å»ºçš„æœ€å¤§åŠ¨æ€åˆ†åŒºä¸ªæ•°ï¼Œè¶…è¿‡ä¼šæŠ¥é”™</td>
</tr>
<tr>
<td>hive.exec.max.created.files</td>
<td>100000</td>
<td>å…¨å±€å¯ä»¥åˆ›å»ºçš„æœ€å¤§æ–‡ä»¶ä¸ªæ•°ï¼Œè¶…è¿‡ä¼šæŠ¥é”™</td>
</tr>
</tbody></table>
<p>å•ä¸ªæŸ¥è¯¢è¯­å¥åˆ›å»ºè¡¨å¹¶åŠ è½½æ•°æ®ï¼š</p>
<pre><code class="sql">create table tbl_test4 as
select name
from tbl_test3
where city = &#39;Beijing&#39;;
</code></pre>
<p>å¯¼å‡ºæ•°æ® <code>insert directory</code>ï¼š</p>
<pre><code class="sql">use db_0323;

-- ç¬¬ä¸€ç§æ–¹å¼
insert overwrite local directory &#39;$&#123;env:HOME&#125;/Documents/Hive/export&#39;
select name, city
from tbl_test3
where city = &#39;Beijing&#39;;

-- ç¬¬äºŒç§æ–¹å¼
from tbl_test3 tmp
insert overwrite local directory &#39;$&#123;env:HOME&#125;/Documents/Hive/export-beijing&#39;
    select name where tmp.city = &#39;Beijing&#39;
insert overwrite local directory &#39;$&#123;env:HOME&#125;/Documents/Hive/export-tianjin&#39;
    select name where tmp.city = &#39;Tianjin&#39;
insert overwrite local directory &#39;$&#123;env:HOME&#125;/Documents/Hive/export-tianjing&#39;
    select name where tmp.city = &#39;Tianjing&#39;;
</code></pre>
<p><em>Hive ä¸­æ²¡æœ‰ä¸´æ—¶è¡¨çš„æ¦‚å¿µã€‚</em></p>
<h2 id="HiveQL-æŸ¥è¯¢"><a href="#HiveQL-æŸ¥è¯¢" class="headerlink" title="HiveQL æŸ¥è¯¢"></a>HiveQL æŸ¥è¯¢</h2><h3 id="å¸¸ç”¨å‡½æ•°ï¼š"><a href="#å¸¸ç”¨å‡½æ•°ï¼š" class="headerlink" title="å¸¸ç”¨å‡½æ•°ï¼š"></a>å¸¸ç”¨å‡½æ•°ï¼š</h3><table>
<thead>
<tr>
<th>è¿”å›å€¼ç±»å‹</th>
<th>å‡½æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>BIGINT</td>
<td>round(double d)</td>
<td>å–è¿‘ä¼¼å€¼</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>round(double d, int n)</td>
<td>å–è¿‘ä¼¼å€¼ï¼Œä¿ç•™ n ä½å°æ•°</td>
</tr>
<tr>
<td>BIGINT</td>
<td>floot(double d)</td>
<td>å‘ä¸‹å–æ•´</td>
</tr>
<tr>
<td>BIGINT</td>
<td>ceil(double d)</td>
<td>å‘ä¸Šå–æ•´</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>rand()</td>
<td>ç”Ÿæˆä¸€ä¸ª DOUBLE ç±»å‹çš„éšæœºæ•°</td>
</tr>
<tr>
<td>STRING</td>
<td>concat_ws(string separator, string s1, string s2â€¦)</td>
<td>ä½¿ç”¨æŒ‡å®šçš„åˆ†éš”ç¬¦è¿æ¥å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>STRING</td>
<td>substr(string s, int start, int length)</td>
<td>æˆªå–å­å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>STRING</td>
<td>to_date(string date)</td>
<td>â€˜2022-01-01 10:20:12â€™ -&gt; â€˜2022-01-01â€™</td>
</tr>
<tr>
<td>INT</td>
<td>year(string date)</td>
<td>è¿”å›å¹´</td>
</tr>
<tr>
<td>INT</td>
<td>month</td>
<td>è·å–æœˆä»½</td>
</tr>
<tr>
<td>INT</td>
<td>date_diff(string date1, string date2)</td>
<td>è·å–ä¸¤ä¸ªæ—¥æœŸç›¸å·®å¤©æ•°</td>
</tr>
<tr>
<td>INT</td>
<td>date_add(string date, int days)</td>
<td>æ—¥æœŸç›¸åŠ </td>
</tr>
<tr>
<td>INT</td>
<td>date_sub(string date, int days)</td>
<td>æ—¥æœŸç›¸å‡</td>
</tr>
</tbody></table>
<h3 id="åµŒå¥—-SELECT"><a href="#åµŒå¥—-SELECT" class="headerlink" title="åµŒå¥— SELECT"></a>åµŒå¥— SELECT</h3><pre><code class="sql">from (
    select name, age
  from tbl_test3
  where age &gt; 10
) tmp
select tmp.*
where tmp.name like &#39;zhang%&#39;;
</code></pre>
<h3 id="CASE-WHEN"><a href="#CASE-WHEN" class="headerlink" title="CASE WHEN"></a>CASE WHEN</h3><pre><code class="sql">select name,
       case
         when age &lt; 18 then &#39;æœªæˆå¹´&#39;
         when age &gt;= 18 and age &lt; 60 then &#39;æˆå¹´&#39;
         else &#39;è€å¹´&#39;
       end as age,
       sex
 from tbl_test;
</code></pre>
<h3 id="é¿å…è¿›è¡Œ-MapReduce"><a href="#é¿å…è¿›è¡Œ-MapReduce" class="headerlink" title="é¿å…è¿›è¡Œ MapReduce"></a>é¿å…è¿›è¡Œ MapReduce</h3><ul>
<li>where æ¡ä»¶ä¸­è¿‡æ»¤å­—æ®µæ˜¯åˆ†åŒºå­—æ®µ</li>
<li>æ²¡æœ‰ where æ¡ä»¶çš„ select è¯­å¥</li>
<li>hive.exec.mode.local.auto&#x3D;true ä¼šå°è¯•æœ¬åœ°æ¨¡å¼æ‰§è¡Œå…¶ä»– SQL</li>
</ul>
<h3 id="ç±»å‹è½¬æ¢-cast"><a href="#ç±»å‹è½¬æ¢-cast" class="headerlink" title="ç±»å‹è½¬æ¢ cast"></a>ç±»å‹è½¬æ¢ cast</h3><p><em>æœ€å¥½ä½¿ç”¨ ceil &#x2F; floor &#x2F; round ç­‰å‡½æ•°æ¥å°†å­—ç¬¦ä¸²è½¬ä¸ºæ•´æ•°ã€‚</em></p>
<h3 id="æŠ½æ ·æŸ¥è¯¢"><a href="#æŠ½æ ·æŸ¥è¯¢" class="headerlink" title="æŠ½æ ·æŸ¥è¯¢"></a>æŠ½æ ·æŸ¥è¯¢</h3><p>æŒ‰ç…§ï¼ˆåŸºäºè¡Œæ•°çš„ï¼‰ç™¾åˆ†æ¯”è¿›è¡ŒæŠ½æ ·ã€‚</p>
<pre><code class="sql">select * from tbl_student_info_tmp tablesample(50 percent);
</code></pre>
<h3 id="UNION-ALL"><a href="#UNION-ALL" class="headerlink" title="UNION ALL"></a>UNION ALL</h3><p>å°†å¤šä¸ªå­è¡¨è¿›è¡Œåˆå¹¶ï¼Œè¿™å‡ ä¸ªå­è¡¨çš„åˆ—åŠé¡ºåºåŠç±»å‹å¿…é¡»å®Œå…¨ä¸€è‡´ï¼Œç†è®ºä¸Šå¯ä»¥æ”¹ä¸ºå¤šä¸ª where è¯­å¥ã€‚</p>
<h2 id="HiveQL-è§†å›¾"><a href="#HiveQL-è§†å›¾" class="headerlink" title="HiveQL è§†å›¾"></a>HiveQL è§†å›¾</h2><p>å¯ä»¥ä½¿ç”¨è§†å›¾ç®€åŒ–æŸ¥è¯¢ï¼š</p>
<pre><code class="sql">-- æ‰€æœ‰æ¥è‡ªåŒ—äº¬çš„å­¦ç”Ÿ
create view view_student_beijing as
select uid, name, age, grade, class
from tbl_student_info
where home_address.province = &#39;åŒ—äº¬&#39;;

-- æ¥è‡ªåŒ—äº¬å¹´é¾„å°äº 20 çš„å­¦ç”Ÿ
select *
from view_student_beijing
where ceil(age) &lt;= 20;
</code></pre>
<p>åˆ é™¤è§†å›¾ï¼š</p>
<pre><code class="sql">drop view if exists view_student_beijing;
</code></pre>
<p><em>è§†å›¾ä¸èƒ½åšä¸º load å’Œ insert çš„ç›®æ ‡è¡¨ã€‚è§†å›¾æ˜¯åªè¯»çš„ï¼Œåªå…è®¸æ”¹å˜ä¸æ•°æ®ä¿¡æ¯ tblpropretiesã€‚</em></p>
<pre><code class="sql">alter view set tblproperties(&#39;created_by&#39;=&#39;system&#39;);
</code></pre>
<h2 id="HiveQL-ç´¢å¼•"><a href="#HiveQL-ç´¢å¼•" class="headerlink" title="HiveQL ç´¢å¼•"></a>HiveQL ç´¢å¼•</h2><h2 id="æ¨¡å¼è®¾è®¡"><a href="#æ¨¡å¼è®¾è®¡" class="headerlink" title="æ¨¡å¼è®¾è®¡"></a>æ¨¡å¼è®¾è®¡</h2><h3 id="åˆ†åŒºè¡¨"><a href="#åˆ†åŒºè¡¨" class="headerlink" title="åˆ†åŒºè¡¨"></a>åˆ†åŒºè¡¨</h3><p>éšç€ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„å¢åŠ ï¼Œè¡¨æ•°æ®é‡ä¼šè¶Šæ¥è¶Šå¤§ï¼ŒHive æŸ¥è¯¢é€šå¸¸æ˜¯å…¨è¡¨æ‰«æï¼Œæ€§èƒ½ä¼šè¶Šæ¥è¶Šä½ã€‚å¯ä»¥ä½¿ç”¨åˆ†åŒºè¡¨æé«˜æ€§èƒ½ã€‚</p>
<pre><code class="sql">create table tbl_test(name string)
partitioned by (kind string);
</code></pre>
<p>åˆ†åŒºåˆ—åªæ˜¯ä¸€ä¸ªç›®å½•åç§°ï¼Œå®é™…ä¸å­˜å‚¨è¿™ä¸€åˆ—æ•°æ®ã€‚</p>
<p>åº”è¯¥é€‰æ‹©åˆé€‚çš„åˆ†åŒºå­—æ®µï¼Œå¦‚æœåˆ†åŒºæ•°å¤ªå¤§ï¼Œä¼šåˆ›å»ºå¤§é‡çš„ Hadoop æ–‡ä»¶åŠæ–‡ä»¶å¤¹ï¼Œåè€Œä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>å¯ä»¥é€‰æ‹©å¤šä¸ªåˆ†åŒºå­—æ®µæ¥è¿›è¡Œåˆ†åŒºã€‚</p>
<pre><code class="sql">create table student (
    name string,
  sex string
) partitioned by (grade string, class string);
</code></pre>
<p>æŸ¥çœ‹åˆ†åŒºï¼š</p>
<pre><code class="sql">show partitions table_name;
</code></pre>
<h3 id="å”¯ä¸€é”®å’Œæ ‡å‡†åŒ–"><a href="#å”¯ä¸€é”®å’Œæ ‡å‡†åŒ–" class="headerlink" title="å”¯ä¸€é”®å’Œæ ‡å‡†åŒ–"></a>å”¯ä¸€é”®å’Œæ ‡å‡†åŒ–</h3><p>Hive æ²¡æœ‰å…³ç³»å‹æ•°æ®åº“ä¸­çš„å”¯ä¸€é”®å’Œåºåˆ—è‡ªå¢ï¼Œåº”é¿å…å¯¹éæ ‡å‡†åŒ–ï¼ˆï¼Ÿï¼‰æ•°æ®è¿›è¡Œ JOIN æ“ä½œï¼Œå¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ Arrayã€Mapã€STRUCT å®ç°ã€‚</p>
<h3 id="åŒä¸€ä»½æ•°æ®å¤„ç†å¤šæ¬¡"><a href="#åŒä¸€ä»½æ•°æ®å¤„ç†å¤šæ¬¡" class="headerlink" title="åŒä¸€ä»½æ•°æ®å¤„ç†å¤šæ¬¡"></a>åŒä¸€ä»½æ•°æ®å¤„ç†å¤šæ¬¡</h3><p>Hive å¯ä»¥ä»ä¸€ä¸ªæ•°æ®æºäº§ç”Ÿå¤šä¸ªæ•°æ®èšåˆï¼Œè€Œæ— éœ€æ¯æ¬¡èšåˆéƒ½é‡æ–°æ‰«æä¸€æ¬¡ï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚</p>
<pre><code class="sql">from tbl_student_info_tmp
insert overwrite tbl_student_info1 where age &gt; 10;
insert overwrite tbl_student_info2 where age &gt; 20;
</code></pre>
<h3 id="å¯¹äºæ¯ä¸ªè¡¨çš„åˆ†åŒº"><a href="#å¯¹äºæ¯ä¸ªè¡¨çš„åˆ†åŒº" class="headerlink" title="å¯¹äºæ¯ä¸ªè¡¨çš„åˆ†åŒº"></a>å¯¹äºæ¯ä¸ªè¡¨çš„åˆ†åŒº</h3><p>å¯¹äºä¸€äº›ä¸­é—´æ•°æ®å¯ä»¥ä½¿ç”¨åˆ†åŒºï¼Œå¯ä»¥ä¿è¯ä»»åŠ¡é‡è·‘çš„æ—¶å€™ä¸ä¼šè¦†ç›–æ‰€æœ‰çš„æ•°æ®ï¼Œåªå¯¹ç›®æ ‡æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p>
<p>è¿™å‡ ä¸ªæœˆè´Ÿè´£å…¬å¸ä¸€äº›æ•°æ®çš„å¤„ç†ï¼ŒåŸºæœ¬éƒ½æ˜¯æŒ‰æœˆæ‹‰ç»“æœï¼Œä½¿ç”¨æœˆæœ«çš„æ—¶é—´åšä¸ºåˆ†åŒºï¼Œè¿™æ ·æ¯ä¸€ä¸ªæœˆçš„æ•°æ®éƒ½å¯ä»¥ç•™å­˜ä¸‹æ¥æˆä¸ºå†å²æ•°æ®ï¼Œä¸å—ä¸‹ä¸ªæœˆæ•°æ®çš„å½±å“ã€‚</p>
<h3 id="åˆ†æ¡¶-ğŸª£"><a href="#åˆ†æ¡¶-ğŸª£" class="headerlink" title="åˆ†æ¡¶ ğŸª£"></a>åˆ†æ¡¶ ğŸª£</h3><p>Hiveè¡¨åˆ†åŒºçš„å®è´¨æ˜¯åˆ†ç›®å½•ï¼ˆå°†è¶…å¤§è¡¨çš„æ•°æ®æŒ‰æŒ‡å®šæ ‡å‡†ç»†åˆ†åˆ°æŒ‡å®šç›®å½•ï¼‰ï¼Œä¸”åˆ†åŒºçš„å­—æ®µä¸å±äºHiveè¡¨ä¸­å­˜åœ¨çš„å­—æ®µï¼›åˆ†æ¡¶çš„å®è´¨æ˜¯åˆ†æ–‡ä»¶ï¼ˆå°†è¶…å¤§æ–‡ä»¶çš„æ•°æ®æŒ‰æŒ‡å®šæ ‡å‡†ç»†åˆ†åˆ°åˆ†æ¡¶æ–‡ä»¶ï¼‰ï¼Œä¸”åˆ†æ¡¶çš„å­—æ®µå¿…é¡»åœ¨Hiveè¡¨ä¸­å­˜åœ¨ã€‚</p>
<p>åˆ†æ¡¶çš„å¥½å¤„åœ¨äºè¡¨ä¸­çš„æ•°æ®å·²ç»æŒ‰æ¡ä»¶åˆ†åˆ°äº†å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œjoin æˆ–è€…å…¶ä»–è®¡ç®—æ—¶åªéœ€å–ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<pre><code class="sql">-- åˆ›å»ºåˆ†æ¡¶è¡¨
use db_0327;

drop table if exists bucket_tbl_student_info;

create table if not exists bucket_tbl_student_info (
  uid string comment &#39;uid&#39;,
  name string comment &#39;name&#39;,
  age int comment &#39;age&#39;
) clustered by (age) into 2 buckets
row format delimited
fields terminated by &#39;,&#39;
lines terminated by &#39;\n&#39;;


-- å°†æ•°æ®å†™å…¥åˆ†æ¡¶è¡¨
set hiveconf:hive.enforce.bucketing=true;

use db_0327;

from tbl_student_info_tmp
insert overwrite table bucket_tbl_student_info
select uid, name, floor(age) as age where 1 = 1;


-- å¦‚æœä¸è®¾ç½®  hiveconf:mapred.reduce.tasksï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸åˆ†æ¡¶ä¸ªæ•°ç›¸ç­‰çš„ reducer æ•°
set hiveconf:mapred.reduce.tasks=2;

use db_0327;

from tbl_student_info_tmp
insert into table bucket_tbl_student_info
select uid, name, floor(age)
where 1 = 1
cluster by age;


-- ä»åˆ†æ¡¶è¡¨ä¸­è·å–æŠ½æ ·æ•°æ®
select uid, name, age from bucket_tbl_student_info tablesample(bucket 1 out of 2 on age);
</code></pre>
<p><em>å°† hive.enforce.bucketing è®¾ç½®æˆ true ä¹‹åï¼ŒHive ä¼šåœ¨ç›®æ ‡è¡¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªæ­£ç¡®çš„ reducer æ•°ã€‚</em></p>
<h3 id="ä¸ºè¡¨æ–°å¢åˆ—"><a href="#ä¸ºè¡¨æ–°å¢åˆ—" class="headerlink" title="ä¸ºè¡¨æ–°å¢åˆ—"></a>ä¸ºè¡¨æ–°å¢åˆ—</h3><blockquote>
<p>Hive è¡¨å¯¹æ•°æ®æ ¼å¼çš„è¦æ±‚æ¯”è¾ƒå®½æ¾ï¼Œåˆ—çš„ä¿¡æ¯åœ¨å…ƒæ•°æ®ä¸­ï¼Œæ–°å¢åˆ—æˆ–è€…åˆ é™¤åˆ—åªæ˜¯æ”¹å˜å…ƒæ•°æ®ã€‚å¦‚æœåˆ—çš„ä¸ªæ•°æ¯”å®é™…æ•°æ®çš„åˆ—è¦å¤šï¼Œåˆ™å¤šä½™çš„åˆ—ä¼šè¢«çœç•¥ï¼Œç›¸åï¼Œåˆ™ä¼šä»¥ NULL å¡«å……ã€‚</p>
</blockquote>
<p>Hive è¡¨æ–°å¢åˆ—ï¼š</p>
<pre><code class="sql">alter table tbl_access_log add columns (rank1 int, rank2 int);
</code></pre>
<p>åœ¨æ–°å¢åˆ—ä¹‹å‰å…¥åº“çš„æ•°æ®ï¼ŒæŸ¥è¯¢çš„æ—¶å€™æ–°åŠ çš„å­—æ®µä¼šç”¨ NULL å¡«å……ã€‚</p>
<h3 id="ä½¿ç”¨åˆ—å­˜å‚¨è¡¨-ğŸ“¦"><a href="#ä½¿ç”¨åˆ—å­˜å‚¨è¡¨-ğŸ“¦" class="headerlink" title="ä½¿ç”¨åˆ—å­˜å‚¨è¡¨ ğŸ“¦"></a>ä½¿ç”¨åˆ—å­˜å‚¨è¡¨ ğŸ“¦</h3><p>Hive é»˜è®¤ä½¿ç”¨è¡Œå¼å­˜å‚¨ã€‚å‡è®¾æœ‰è¶³å¤Ÿå¤šçš„åˆ—ï¼Œåˆ—ä¸­æœ‰å¾ˆå¤šçš„é‡å¤æ•°æ®ï¼Œè¿™ç§ç±»å‹çš„æ•°æ®ä½¿ç”¨åˆ—å¼å­˜å‚¨æ€§èƒ½ä¼šæ›´å¥½ï¼ŒæŸ¥è¯¢çš„æ—¶å€™ä¸è¦åŠ è½½æ‰€æœ‰åˆ—çš„æ•°æ®ã€‚</p>
<p><em>å‚è§ 15.3.2 RCfile ä½¿ç”¨è¿™ç§æ ¼å¼ï¼Ÿ</em></p>
<h3 id="ä½¿ç”¨å‹ç¼©-ğŸ—œï¸"><a href="#ä½¿ç”¨å‹ç¼©-ğŸ—œï¸" class="headerlink" title="ä½¿ç”¨å‹ç¼© ğŸ—œï¸"></a>ä½¿ç”¨å‹ç¼© ğŸ—œï¸</h3><p>å‡ ä¹æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å‹ç¼©éƒ½èƒ½é™ä½ç£ç›˜å ç”¨é‡ï¼Œé™ä½ I&#x2F;O ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚</p>
<p>ä½¿ç”¨å¤–éƒ¨æ•°æ®æˆ–è€…éå‹ç¼©æ ¼å¼æ—¶æ— æ³•ä½¿ç”¨å‹ç¼©ã€‚</p>
<p>å‹ç¼©å’Œè§£å‹ç¼©éƒ½ä¼šæ¶ˆè€— CPU èµ„æºï¼Œä½†æ˜¯å¤§å¤šæ•° MR ä»»åŠ¡éƒ½æ˜¯ I&#x2F;O å¯†é›†å‹ä»»åŠ¡ï¼Œæ‰€ä»¥ CPU å¼€é”€é€šå¸¸ä¸æ˜¯é—®é¢˜ã€‚</p>
<h2 id="Hive-å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆè®°å½•-ğŸ“"><a href="#Hive-å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆè®°å½•-ğŸ“" class="headerlink" title="Hive å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆè®°å½• ğŸ“"></a>Hive å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆè®°å½• ğŸ“</h2><p>1ã€å¯åŠ¨ Hive æŠ¥é”™ï¼šCannot create directory &#x2F;tmp&#x2F;hive&#x2F;longkun&#x2F;50be98c2-62e0-4b37-9002-c2270fed6a20. Name node is in safe mode.</p>
<blockquote>
<p>æ§åˆ¶å°æ—¥å¿—æç¤ºæ— æ³•åˆ›å»ºä¸´æ—¶ç›®å½•ï¼ŒHive å¤„äºå®‰å…¨æ¨¡å¼ä¸­ã€‚</p>
<p>å®‰å…¨æ¨¡å¼ä¸»è¦æ˜¯ HDFS ç³»ç»Ÿçš„æ—¶å€™æ£€æŸ¥ DataNode ä¸Šæ•°æ®å—çš„æœ‰æ•ˆæ€§ï¼ŒåŒæ—¶æ ¹æ®ç­–ç•¥å¤åˆ¶å’Œåˆ é™¤éƒ¨åˆ†æ•°æ®å—ï¼Œè¿è¡Œçš„æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¿›å…¥å®‰å…¨æ¨¡å¼ã€‚å®‰å…¨æ¨¡å¼ä¸­ä¸å…è®¸ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ã€‚</p>
<p>å¯ä»¥é€šè¿‡å‘½ä»¤æ¥ç¦»å¼€å®‰å…¨ğŸ”æ¨¡å¼ï¼š<code>hadoop dfsadmin -safemode leave</code> </p>
<p>ç¦»å¼€å®‰å…¨æ¨¡å¼ä¹‹åï¼ŒHive æ­£å¸¸å¯åŠ¨ã€‚</p>
</blockquote>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>åŠ è½½è¯„è®ºéœ€è¦åœ¨æµè§ˆå™¨å¯ç”¨ JavaScript è„šæœ¬æ”¯æŒã€‚</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">é¦–é¡µ</a></li>
        
          <li><a href="/archives/">å½’æ¡£</a></li>
        
          <li><a href="/friends/">å‹é“¾</a></li>
        
          <li><a href="/about/">å…³äº</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">å¼€å¾€ ğŸš‡</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-Hive"><span class="toc-number">1.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦ Hive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E7%9A%84%E5%B1%80%E9%99%90"><span class="toc-number">1.2.</span> <span class="toc-text">Hive çš„å±€é™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java-%E5%92%8C-Hive-%EF%BC%9A%E8%AF%8D%E9%A2%91%E7%BB%9F%E8%AE%A1%E7%AE%97%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">Java å’Œ Hive ï¼šè¯é¢‘ç»Ÿè®¡ç®—æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">Hive å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CLI-%E9%80%89%E9%A1%B9"><span class="toc-number">2.1.</span> <span class="toc-text">CLI é€‰é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E7%9A%84%E5%B1%9E%E6%80%A7%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">2.2.</span> <span class="toc-text">Hive çš„å±æ€§å‘½åç©ºé—´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%B8%80%E6%AC%A1%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">Hive ä¸­ä½¿ç”¨ä¸€æ¬¡å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.4.</span> <span class="toc-text">ä»æ–‡ä»¶ä¸­æ‰§è¡ŒæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hiverc%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">hivercæ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C-shell-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.</span> <span class="toc-text">æ‰§è¡Œ shell å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Hive-%E5%86%85%E4%BD%BF%E7%94%A8-dfs-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.7.</span> <span class="toc-text">åœ¨ Hive å†…ä½¿ç”¨ dfs å‘½ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">æ•°æ®ç±»å‹å’Œæ–‡ä»¶æ ¼å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#byte%E3%80%81Byte%E3%80%81bit%E3%80%81%E5%AD%97%E8%8A%82"><span class="toc-number">3.1.</span> <span class="toc-text">byteã€Byteã€bitã€å­—èŠ‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">Hive ä¸­çš„æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text">é›†åˆç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89"><span class="toc-number">4.</span> <span class="toc-text">HiveQL æ•°æ®å®šä¹‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">4.1.</span> <span class="toc-text">æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.2.</span> <span class="toc-text">å¸¸è§æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8%E4%B8%8E%E5%A4%96%E9%83%A8%E8%A1%A8%EF%BC%88MANAGED-TABLE-EXTERNAL-TABLE%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">å†…éƒ¨è¡¨ä¸å¤–éƒ¨è¡¨ï¼ˆMANAGED_TABLE &amp; EXTERNAL_TABLEï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8"><span class="toc-number">5.</span> <span class="toc-text">åˆ†åŒºè¡¨å’Œç®¡ç†è¡¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">å¯¹è¡¨çš„æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">7.</span> <span class="toc-text">HiveQL æ•°æ®æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.</span> <span class="toc-text">HiveQL æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="toc-number">8.1.</span> <span class="toc-text">å¸¸ç”¨å‡½æ•°ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97-SELECT"><span class="toc-number">8.2.</span> <span class="toc-text">åµŒå¥— SELECT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CASE-WHEN"><span class="toc-number">8.3.</span> <span class="toc-text">CASE WHEN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E8%BF%9B%E8%A1%8C-MapReduce"><span class="toc-number">8.4.</span> <span class="toc-text">é¿å…è¿›è¡Œ MapReduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2-cast"><span class="toc-number">8.5.</span> <span class="toc-text">ç±»å‹è½¬æ¢ cast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E6%A0%B7%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.6.</span> <span class="toc-text">æŠ½æ ·æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UNION-ALL"><span class="toc-number">8.7.</span> <span class="toc-text">UNION ALL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E8%A7%86%E5%9B%BE"><span class="toc-number">9.</span> <span class="toc-text">HiveQL è§†å›¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HiveQL-%E7%B4%A2%E5%BC%95"><span class="toc-number">10.</span> <span class="toc-text">HiveQL ç´¢å¼•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1"><span class="toc-number">11.</span> <span class="toc-text">æ¨¡å¼è®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="toc-number">11.1.</span> <span class="toc-text">åˆ†åŒºè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E9%94%AE%E5%92%8C%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-number">11.2.</span> <span class="toc-text">å”¯ä¸€é”®å’Œæ ‡å‡†åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E5%A4%9A%E6%AC%A1"><span class="toc-number">11.3.</span> <span class="toc-text">åŒä¸€ä»½æ•°æ®å¤„ç†å¤šæ¬¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E6%AF%8F%E4%B8%AA%E8%A1%A8%E7%9A%84%E5%88%86%E5%8C%BA"><span class="toc-number">11.4.</span> <span class="toc-text">å¯¹äºæ¯ä¸ªè¡¨çš„åˆ†åŒº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%A1%B6-%F0%9F%AA%A3"><span class="toc-number">11.5.</span> <span class="toc-text">åˆ†æ¡¶ ğŸª£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E8%A1%A8%E6%96%B0%E5%A2%9E%E5%88%97"><span class="toc-number">11.6.</span> <span class="toc-text">ä¸ºè¡¨æ–°å¢åˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%88%97%E5%AD%98%E5%82%A8%E8%A1%A8-%F0%9F%93%A6"><span class="toc-number">11.7.</span> <span class="toc-text">ä½¿ç”¨åˆ—å­˜å‚¨è¡¨ ğŸ“¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8E%8B%E7%BC%A9-%F0%9F%97%9C%EF%B8%8F"><span class="toc-number">11.8.</span> <span class="toc-text">ä½¿ç”¨å‹ç¼© ğŸ—œï¸</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E8%AE%B0%E5%BD%95-%F0%9F%93%9D"><span class="toc-number">12.</span> <span class="toc-text">Hive å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆè®°å½• ğŸ“</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li> -->
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&text=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&is_video=false&description=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li> -->
  <li><a class="icon" href="mailto:?subject=Hiveå­¦ä¹ ç¬”è®°&body=Check out this article: https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&title=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&name=Hiveå­¦ä¹ ç¬”è®°&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lozhu.happy365.day/2022/03/20/c5e8e7b94e93/&t=Hiveå­¦ä¹ ç¬”è®°"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li> -->
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    <!-- Copyright --> &copy;
    
    
    2018-2024
    lozhu
  </div>
  
    <div>
      <a href="https://icp.gov.moe/?keyword=20249900" target="_blank">èŒICPå¤‡ 20249900 å·</a>
    </div>
  
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/friends/">å‹é“¾</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">å¼€å¾€ ğŸš‡</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸï¼");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8bdf047ae0a66729bd3b27e8bb56fe11";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      </script>

<!-- 51la Analytics -->

  <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
  <script>
  LA.init({
      id: '3I0QIERSX42bDzDc',
      ck: '3I0QIERSX42bDzDc'
  })
  </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'lozhu20/my-blog-comments';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-light';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

<!-- image modal -->
<script>
  (function() {
    var contentNode = document.getElementsByClassName('content e-content');
    if (!contentNode || contentNode.length === 0) {
      console.log('no content, exit');
      return;
    }

    var imgsNodes = contentNode[0].getElementsByTagName('img');
    if (!imgsNodes || imgsNodes.length === 0) {
      console.log('no image, exit');
      return;
    }

    var span = document.getElementById('modal_close_btn');
    span.onclick = function() { 
      modal.style.display = "none";
    };

    var modal = document.getElementById('modal');
    var modalImage = document.getElementById('modal_image');
    var captionText = document.getElementById('caption');

    for (var i = imgsNodes.length - 1; i >= 0; i--) {
      let image = imgsNodes[i];
      image.onclick = function() {
        modal.style.display = "block";
        modalImage.src = this.src;
        captionText.innerHTML = this.alt || "æ–‡ç« é…å›¾";
      };
    }
  }());
</script>

</body>
</html>
