<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="baidu-site-verification" content="codeva-OBV0UPgBod" />
    <meta name="msvalidate.01" content="B9019CE3751A15D63E78AF8679980069" />
    <meta name="description" content="æœåŠ¡åœ°å€https:&#x2F;&#x2F;t.happy365.day æœåŠ¡éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œç”± cloudflare tunnel æä¾›å†…ç½‘ç©¿é€æœåŠ¡ã€‚ èƒŒæ™¯åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°ä¸€ç¯‡å…³äºçŸ­é“¾ç”Ÿæˆçš„è®¾è®¡æ–‡æ¡£ ç³»ç»Ÿè®¾è®¡ä¹‹è·¯ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªURLçŸ­é“¾æœåŠ¡ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¾ƒå¤šï¼ŒåŒ…æ‹¬ï¼šçŸ­é“¾æ–¹æ¡ˆè®¾è®¡åŠå–èˆã€åˆ†åº“åˆ†è¡¨ã€é«˜å¯ç”¨è®¾è®¡ç­‰ã€‚ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„éœ€æ±‚æƒ³è¦çœŸæ­£ä¸Šçº¿ï¼Œéœ€è¦éœ€è¦å®ç°åŠŸèƒ½ï¼Œè¿˜è¦å…¼é¡¾æ€§èƒ½ã€å®‰å…¨æ€§ã€å¯é æ€§ç­‰å„ä¸ªæ–¹é¢ã€‚äºæ˜¯æƒ³äº²è‡ªä¸Šçº¿ä¸€ä¸ªçŸ­">
<meta property="og:type" content="article">
<meta property="og:title" content="åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡">
<meta property="og:url" content="https://lozhu.happy365.day/2024/04/13/7c444bb72964/index.html">
<meta property="og:site_name" content="Lozhu&#39;s blog">
<meta property="og:description" content="æœåŠ¡åœ°å€https:&#x2F;&#x2F;t.happy365.day æœåŠ¡éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œç”± cloudflare tunnel æä¾›å†…ç½‘ç©¿é€æœåŠ¡ã€‚ èƒŒæ™¯åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°ä¸€ç¯‡å…³äºçŸ­é“¾ç”Ÿæˆçš„è®¾è®¡æ–‡æ¡£ ç³»ç»Ÿè®¾è®¡ä¹‹è·¯ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªURLçŸ­é“¾æœåŠ¡ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¾ƒå¤šï¼ŒåŒ…æ‹¬ï¼šçŸ­é“¾æ–¹æ¡ˆè®¾è®¡åŠå–èˆã€åˆ†åº“åˆ†è¡¨ã€é«˜å¯ç”¨è®¾è®¡ç­‰ã€‚ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„éœ€æ±‚æƒ³è¦çœŸæ­£ä¸Šçº¿ï¼Œéœ€è¦éœ€è¦å®ç°åŠŸèƒ½ï¼Œè¿˜è¦å…¼é¡¾æ€§èƒ½ã€å®‰å…¨æ€§ã€å¯é æ€§ç­‰å„ä¸ªæ–¹é¢ã€‚äºæ˜¯æƒ³äº²è‡ªä¸Šçº¿ä¸€ä¸ªçŸ­">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-04-13T03:45:00.000Z">
<meta property="article:modified_time" content="2024-12-08T06:50:57.175Z">
<meta property="article:author" content="lozhu">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="Vue.js">
<meta property="article:tag" content="çŸ­é“¾æ¥">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XMGS491MQF"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XMGS491MQF');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Lozhu's blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="modal" class="modal">
  <span id="modal_close_btn" class="modal-close-btn">x</span>
  <img id="modal_image" class="modal-image">
  <!-- <div id="caption"></div> -->
</div>

      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="é¡¶éƒ¨" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/friends/">å‹é“¾</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">å¼€å¾€ ğŸš‡</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="ä¸Šä¸€ç¯‡" href="/2024/04/14/5b6c6f78fbdb/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡" href="/2024/04/10/69d2730f1338/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="è¿”å›é¡¶éƒ¨" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº«æ–‡ç« " href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lozhu.happy365.day/2024/04/13/7c444bb72964/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li> -->
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&text=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&is_video=false&description=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li> -->
  <li><a class="icon" href="mailto:?subject=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡&body=Check out this article: https://lozhu.happy365.day/2024/04/13/7c444bb72964/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-reddit " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-digg " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&name=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&t=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li> -->
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80"><span class="toc-number">1.</span> <span class="toc-text">æœåŠ¡åœ°å€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">2.</span> <span class="toc-text">èƒŒæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%B7%E5%80%BC"><span class="toc-number">3.</span> <span class="toc-text">ä»·å€¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">4.</span> <span class="toc-text">éœ€æ±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">åŠŸèƒ½æ€§éœ€æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%8A%9F%E8%83%BD%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">4.2.</span> <span class="toc-text">éåŠŸèƒ½æ€§éœ€æ±‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E9%87%8F%E9%A2%84%E6%9C%9F"><span class="toc-number">5.</span> <span class="toc-text">ç³»ç»Ÿæ•°æ®é‡é¢„æœŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88"><span class="toc-number">6.</span> <span class="toc-text">çŸ­é“¾ç”Ÿæˆæ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%A2%9Eid"><span class="toc-number">6.1.</span> <span class="toc-text">è‡ªå¢id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">æ™®é€šéšæœºæ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash"><span class="toc-number">6.3.</span> <span class="toc-text">Hash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">7.</span> <span class="toc-text">æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%89%E6%8B%A9"><span class="toc-number">7.1.</span> <span class="toc-text">æ•°æ®åº“é€‰æ‹©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E6%96%B9%E6%A1%88"><span class="toc-number">7.2.</span> <span class="toc-text">åˆ†åº“æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%A1%A8%E6%96%B9%E6%A1%88"><span class="toc-number">7.3.</span> <span class="toc-text">åˆ†è¡¨æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.4.</span> <span class="toc-text">è¡¨ç»“æ„è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">7.5.</span> <span class="toc-text">åˆ›å»ºè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%88%86%E5%8C%BA%E8%A1%A8%E5%88%9B%E5%BB%BA%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">7.6.</span> <span class="toc-text">å®ç°åˆ†åŒºè¡¨åˆ›å»ºè‡ªåŠ¨åŒ–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">8.</span> <span class="toc-text">æŠ€æœ¯é€‰å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">8.1.</span> <span class="toc-text">æ•°æ®åº“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-number">8.2.</span> <span class="toc-text">åç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">8.3.</span> <span class="toc-text">å‰ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8"><span class="toc-number">8.4.</span> <span class="toc-text">å®¹å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Docker-%E9%83%A8%E7%BD%B2%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.</span> <span class="toc-text">ä½¿ç”¨ Docker éƒ¨ç½²æ•°æ®åº“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E9%83%A8%E7%BD%B2-Postgresql"><span class="toc-number">10.</span> <span class="toc-text">Docker éƒ¨ç½² Postgresql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98"><span class="toc-number">11.</span> <span class="toc-text">ç¼“å­˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">12.</span> <span class="toc-text">åç«¯æ¥å£è®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.1.</span> <span class="toc-text">çŸ­é“¾ç”Ÿæˆæ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.2.</span> <span class="toc-text">çŸ­é“¾ç»Ÿè®¡æ•°æ®æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.3.</span> <span class="toc-text">çŸ­é“¾è®¿é—®æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">13.</span> <span class="toc-text">é«˜å¯ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">13.1.</span> <span class="toc-text">æ•°æ®åº“é«˜å¯ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">13.2.</span> <span class="toc-text">åç«¯æœåŠ¡é«˜å¯ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx-%E9%85%8D%E7%BD%AE"><span class="toc-number">14.</span> <span class="toc-text">nginx é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96"><span class="toc-number">14.1.</span> <span class="toc-text">é•œåƒæ‹‰å–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">14.2.</span> <span class="toc-text">å‡†å¤‡é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">14.3.</span> <span class="toc-text">å¯åŠ¨å®¹å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">15.</span> <span class="toc-text">å‰ç«¯é¡¹ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vue-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">15.1.</span> <span class="toc-text">Vue é¡¹ç›®æ­å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Axios-%E9%85%8D%E7%BD%AE"><span class="toc-number">15.2.</span> <span class="toc-text">Axios é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">15.3.</span> <span class="toc-text">é¡µé¢ä»£ç å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E8%87%B3-nginx"><span class="toc-number">15.4.</span> <span class="toc-text">æ‰“åŒ…éƒ¨ç½²è‡³ nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E9%95%9C%E5%83%8F%E7%94%9F%E6%88%90"><span class="toc-number">15.5.</span> <span class="toc-text">Docker é•œåƒç”Ÿæˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot-MyBatis-%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE"><span class="toc-number">16.</span> <span class="toc-text">Springboot + MyBatis å¤šæ•°æ®æºé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">17.</span> <span class="toc-text">Docker éƒ¨ç½²åç«¯æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jar-%E5%8C%85%E7%94%9F%E6%88%90"><span class="toc-number">17.1.</span> <span class="toc-text">jar åŒ…ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-%E7%BC%96%E5%86%99"><span class="toc-number">17.2.</span> <span class="toc-text">Dockerfile ç¼–å†™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85"><span class="toc-number">17.3.</span> <span class="toc-text">æ‰“åŒ…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx-%E8%BD%AC%E5%8F%91%E9%85%8D%E7%BD%AE"><span class="toc-number">18.</span> <span class="toc-text">nginx è½¬å‘é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="toc-number">19.</span> <span class="toc-text">é—®é¢˜è®°å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="toc-number">20.</span> <span class="toc-text">å…¶ä»–é—®é¢˜è®°å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hashcode-%E5%8F%AF%E8%83%BD%E4%B8%BA%E8%B4%9F%E6%95%B0"><span class="toc-number">20.1.</span> <span class="toc-text">hashcode å¯èƒ½ä¸ºè´Ÿæ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Async-%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98"><span class="toc-number">20.2.</span> <span class="toc-text">@Async å¤±æ•ˆé—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Value-%E5%8F%96%E5%88%B0%E9%94%99%E8%AF%AF%E7%9A%84%E9%85%8D%E7%BD%AE%E5%80%BC"><span class="toc-number">20.3.</span> <span class="toc-text">@Value å–åˆ°é”™è¯¯çš„é…ç½®å€¼</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">lozhu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-04-13T03:45:00.000Z" class="dt-published" itemprop="datePublished">2024-04-13</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E9%A1%B9%E7%9B%AE%E6%97%A5%E5%BF%97/">é¡¹ç›®æ—¥å¿—</a>
    </div>


      
    <!-- <div class="article-tag"> -->
    <div class="article-category">
        <i class="fa-solid fa-tag"></i>
        <!-- <a class="p-category" href="/tags/Docker/" rel="tag">Docker</a>, <a class="p-category" href="/tags/SpringBoot/" rel="tag">SpringBoot</a>, <a class="p-category" href="/tags/Vue-js/" rel="tag">Vue.js</a>, <a class="p-category" href="/tags/%E7%9F%AD%E9%93%BE%E6%8E%A5/" rel="tag">çŸ­é“¾æ¥</a> -->
        <a class="category-link" href="/tags/Docker/" rel="tag">Docker</a>, <a class="category-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a>, <a class="category-link" href="/tags/Vue-js/" rel="tag">Vue.js</a>, <a class="category-link" href="/tags/%E7%9F%AD%E9%93%BE%E6%8E%A5/" rel="tag">çŸ­é“¾æ¥</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="æœåŠ¡åœ°å€"><a href="#æœåŠ¡åœ°å€" class="headerlink" title="æœåŠ¡åœ°å€"></a>æœåŠ¡åœ°å€</h2><p><a target="_blank" rel="noopener" href="https://t.happy365.day/">https://t.happy365.day</a></p>
<p>æœåŠ¡éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œç”± cloudflare tunnel æä¾›å†…ç½‘ç©¿é€æœåŠ¡ã€‚</p>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨çŸ¥ä¹ä¸Šçœ‹åˆ°ä¸€ç¯‡å…³äºçŸ­é“¾ç”Ÿæˆçš„è®¾è®¡æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/370475544">ç³»ç»Ÿè®¾è®¡ä¹‹è·¯ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªURLçŸ­é“¾æœåŠ¡</a>ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¾ƒå¤šï¼ŒåŒ…æ‹¬ï¼šçŸ­é“¾æ–¹æ¡ˆè®¾è®¡åŠå–èˆã€åˆ†åº“åˆ†è¡¨ã€é«˜å¯ç”¨è®¾è®¡ç­‰ã€‚ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„éœ€æ±‚æƒ³è¦çœŸæ­£ä¸Šçº¿ï¼Œéœ€è¦éœ€è¦å®ç°åŠŸèƒ½ï¼Œè¿˜è¦å…¼é¡¾æ€§èƒ½ã€å®‰å…¨æ€§ã€å¯é æ€§ç­‰å„ä¸ªæ–¹é¢ã€‚äºæ˜¯æƒ³äº²è‡ªä¸Šçº¿ä¸€ä¸ªçŸ­é“¾ç”ŸæˆæœåŠ¡ï¼Œé”»ç‚¼ä¸€ä¸‹åŠ¨æ‰‹èƒ½åŠ›ã€‚</p>
<h2 id="ä»·å€¼"><a href="#ä»·å€¼" class="headerlink" title="ä»·å€¼"></a>ä»·å€¼</h2><p>çŸ­é“¾æœåŠ¡åœ¨å¾®åšç±»ç½‘ç«™ä¸­è¾ƒä¸ºæµè¡Œï¼Œä½¿ç”¨çŸ­é“¾æœåŠ¡å¥½å¤„åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç²¾ç®€ç›®æ ‡ç½‘å€ï¼Œç¼©çŸ­æ–‡æœ¬é•¿åº¦ï¼Œä¾¿äºè®°å¿†å’Œä¼ æ’­ï¼›</li>
<li>éšè—ç›®æ ‡åœ°å€åŠå‚æ•°ï¼›</li>
<li>æ§åˆ¶ç›®æ ‡ç½‘å€çš„è·³è½¬ï¼Œä¸å®‰å…¨ç½‘å€å¯ä»¥é™åˆ¶è·³è½¬ã€‚</li>
</ol>
<h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><h3 id="åŠŸèƒ½æ€§éœ€æ±‚"><a href="#åŠŸèƒ½æ€§éœ€æ±‚" class="headerlink" title="åŠŸèƒ½æ€§éœ€æ±‚"></a>åŠŸèƒ½æ€§éœ€æ±‚</h3><ol>
<li>å®ç°é•¿é“¾æ¥è½¬æ¢çŸ­é“¾æ¥ï¼Œé•¿åº¦ç¼©çŸ­ä¸”å”¯ä¸€ï¼›</li>
<li>ç”Ÿæˆä¹‹åçš„çŸ­é“¾æ¥èƒ½æ­£ç¡®è·³è½¬è‡³åŸåœ°å€ï¼›</li>
<li>çŸ­é“¾æ¥å¯ä»¥è®¾ç½®å¤±æ•ˆæ—¶é•¿ï¼Œé»˜è®¤5å¹´ï¼›</li>
</ol>
<h3 id="éåŠŸèƒ½æ€§éœ€æ±‚"><a href="#éåŠŸèƒ½æ€§éœ€æ±‚" class="headerlink" title="éåŠŸèƒ½æ€§éœ€æ±‚"></a>éåŠŸèƒ½æ€§éœ€æ±‚</h3><ol>
<li>æ€§èƒ½ï¼šçŸ­é“¾æ¥è·³è½¬æ—¶é•¿ä¸åŸé“¾æ¥è·³è½¬æ—¶é•¿æ— æ˜æ˜¾å·®å¼‚ï¼›</li>
<li>å®‰å…¨ï¼šçŸ­é“¾æ¥ä¸èƒ½è¢«éå†ï¼›</li>
<li>å¯ç”¨ï¼šä¸èƒ½å­˜åœ¨å•ç‚¹æ•…éšœã€‚</li>
</ol>
<h2 id="ç³»ç»Ÿæ•°æ®é‡é¢„æœŸ"><a href="#ç³»ç»Ÿæ•°æ®é‡é¢„æœŸ" class="headerlink" title="ç³»ç»Ÿæ•°æ®é‡é¢„æœŸ"></a>ç³»ç»Ÿæ•°æ®é‡é¢„æœŸ</h2><p>å†™è¯·æ±‚æ•°ï¼š10ä¸ª&#x2F;s</p>
<p>è¯»è¯·æ±‚æ•°ï¼š100ä¸ª&#x2F;s</p>
<p>5å¹´å†…äº§ç”ŸçŸ­é“¾æ•°é‡ï¼š10 * 60 * 60 * 24 * 365 * 5 &#x3D; 1,576,800,000 ï¼ˆçº¦16äº¿ï¼‰</p>
<p>62 ^ n &gt;&#x3D; 16äº¿ &#x3D;&gt; n &gt;&#x3D; 6</p>
<p>çŸ­ç é•¿åº¦è®¾ç½®ä¸º6ä½ä¸­è‹±æ–‡å¤§å°å†™å­—æ¯å’Œæ•°å­—å¯æ»¡è¶³éœ€æ±‚ã€‚</p>
<h2 id="çŸ­é“¾ç”Ÿæˆæ–¹æ¡ˆ"><a href="#çŸ­é“¾ç”Ÿæˆæ–¹æ¡ˆ" class="headerlink" title="çŸ­é“¾ç”Ÿæˆæ–¹æ¡ˆ"></a>çŸ­é“¾ç”Ÿæˆæ–¹æ¡ˆ</h2><h3 id="è‡ªå¢id"><a href="#è‡ªå¢id" class="headerlink" title="è‡ªå¢id"></a>è‡ªå¢id</h3><p>æ¯æ¬¡è¯·æ±‚ç”Ÿæˆä¸€ä¸ªé€’å¢å”¯ä¸€çš„idï¼Œæ ¹æ®ç”Ÿæˆçš„idè½¬æ¢åˆ°62è¿›åˆ¶å¾—åˆ°ä¸€ä¸ªå”¯ä¸€çš„çŸ­é“¾æ¥ã€‚ä½†æ˜¯æ­¤ç§æ–¹å¼ç”Ÿæˆçš„çŸ­é“¾æ¥æ˜¯æœ‰è§„å¾‹çš„ï¼Œå¦‚æœæ¥å£è¢«æ¶æ„è°ƒç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´çŸ­é“¾æ¥è¢«è¿…é€Ÿæ¶ˆè€—å®Œï¼Œå¹¶ä¸”æµªè´¹æ‰å¤§éƒ¨åˆ†æ€§èƒ½ï¼Œæ­£å¸¸çš„è¯·æ±‚å¾—ä¸åˆ°å¤„ç†ã€‚</p>
<h3 id="æ™®é€šéšæœºæ•°"><a href="#æ™®é€šéšæœºæ•°" class="headerlink" title="æ™®é€šéšæœºæ•°"></a>æ™®é€šéšæœºæ•°</h3><p>æ¯æ¬¡è¯·æ±‚éšæœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå†æ ¹æ®è¿™ä¸ªéšæœºæ•°è¿›è¡Œè½¬æ¢åˆ°62è¿›åˆ¶å¾—åˆ°çŸ­é“¾æ¥ï¼Œå¦‚æœè¯¥çŸ­é“¾æ¥å·²è¢«å ç”¨ï¼Œåˆ™é‡æ–°ç”Ÿæˆéšæœºæ•°ã€‚å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š1.éšç€ç”Ÿæˆçš„çŸ­é“¾æ¥æ•°é‡çš„å¢åŠ ï¼Œç¢°æ’çš„æ¦‚ç‡è¶Šæ¥è¶Šå¤§ï¼›2.ä¼ªéšæœºæ•°å¯ä»¥è¢«æ”»å‡»è€…é¢„æµ‹ã€‚</p>
<h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>ä½¿ç”¨ MurmurHash3 ï¼ˆå¯¹æ¯” md5 éšæœºåˆ†å¸ƒæ€§æ›´å¥½ï¼Œå‘ç”Ÿ Hash ç¢°æ’çš„å‡ ç‡æ›´ä½ï¼Œå¯ä»¥æé«˜æ€§èƒ½ï¼‰ï¼Œå¯¹åŸå§‹é“¾æ¥è¿›è¡Œå“ˆå¸Œï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼Œè½¬æ¢æˆ 62 è¿›åˆ¶å¾—åˆ°çŸ­é“¾æ¥ã€‚å¦‚æœå­˜åœ¨ç¢°æ’ï¼Œåˆ™åœ¨åŸå§‹é“¾æ¥åå¢åŠ ç‰¹å®šåç¼€å†è¿›è¡Œ Hashã€‚</p>
<p>âš ï¸ è¦ç‰¹åˆ«æ³¨æ„ï¼Œhashcode å¯èƒ½ä¸ºè´Ÿæ•°ï¼</p>
<h2 id="æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ"><a href="#æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ" class="headerlink" title="æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ"></a>æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ</h2><h3 id="æ•°æ®åº“é€‰æ‹©"><a href="#æ•°æ®åº“é€‰æ‹©" class="headerlink" title="æ•°æ®åº“é€‰æ‹©"></a>æ•°æ®åº“é€‰æ‹©</h3><p>é€‰æ‹© Postgresql åšä¸ºç³»ç»Ÿæ•°æ®åº“ã€‚</p>
<h3 id="åˆ†åº“æ–¹æ¡ˆ"><a href="#åˆ†åº“æ–¹æ¡ˆ" class="headerlink" title="åˆ†åº“æ–¹æ¡ˆ"></a>åˆ†åº“æ–¹æ¡ˆ</h3><p>å•æ¡è®°å½•å ç”¨å†…å­˜å¤§å°ï¼š</p>
<p> (36 + 512 + 6 + 8 + 4 + 4 + 8 + 100 + 8 + 100) byte &#x3D; 786 byte</p>
<p>5å¹´å†…æ‰€æœ‰è®°å½•å ç”¨å†…å­˜å¤§å°ï¼š</p>
<p>16 äº¿ * 786 byte &#x2F; 1024KB &#x2F; 1024MB &#x2F; 1024 GB &#x3D; 1.13 TB</p>
<p>åˆ† 3 ä¸ªåº“ï¼Œä¸»åº“å†™ï¼Œä»åº“è¯»ï¼Œä¸»ä»å¤åˆ¶ã€‚</p>
<h3 id="åˆ†è¡¨æ–¹æ¡ˆ"><a href="#åˆ†è¡¨æ–¹æ¡ˆ" class="headerlink" title="åˆ†è¡¨æ–¹æ¡ˆ"></a>åˆ†è¡¨æ–¹æ¡ˆ</h3><p>å•è¡¨è®°å½•ä¸è¶…è¿‡ 500 ä¸‡è¡Œï¼Œ16 äº¿ &#x2F; 500 ä¸‡ &#x3D;  320 å¼ è¡¨ï¼Œæ­¤æ—¶å•è¡¨å®¹é‡ä¸º 1130 GB &#x2F; 320 &#x3D; 3.5 GBã€‚å¹³å‡åˆ° 5 å¹´å…± 60 ä¸ªæœˆï¼Œå¤§çº¦ 5.5 å¤©éœ€è¦æ–°å¢ä¸€å¼ è¡¨ï¼Œä¸ºäº†ç®€è¡¨æ–¹ä¾¿ï¼ŒæŒ‰ 5 å¤©æ–°å¢ä¸€å¼ è¡¨å®ç°ã€‚</p>
<h3 id="è¡¨ç»“æ„è®¾è®¡"><a href="#è¡¨ç»“æ„è®¾è®¡" class="headerlink" title="è¡¨ç»“æ„è®¾è®¡"></a>è¡¨ç»“æ„è®¾è®¡</h3><p>URLæ˜ å°„è¡¨ï¼ˆt_url_mappingï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>ç±»å‹</th>
<th>é»˜è®¤å€¼</th>
<th>æ˜¯å¦å¯ç©º</th>
<th>æ˜¯å¦ä¸»é”®</th>
<th>å­—æ®µå«ä¹‰</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>varchar(36)</td>
<td>uuid</td>
<td></td>
<td>Y</td>
<td>ä¸»é”®id</td>
<td></td>
</tr>
<tr>
<td>url</td>
<td>varchar(512)</td>
<td></td>
<td></td>
<td></td>
<td>åŸå§‹URL</td>
<td></td>
</tr>
<tr>
<td>short_url</td>
<td>varchar(6)</td>
<td></td>
<td></td>
<td></td>
<td>çŸ­é“¾æ¥</td>
<td>å”¯ä¸€ç´¢å¼•</td>
</tr>
<tr>
<td>expire_time</td>
<td>timestamp</td>
<td></td>
<td>Y</td>
<td></td>
<td>å¤±æ•ˆæ—¶é—´</td>
<td></td>
</tr>
<tr>
<td>status</td>
<td>int</td>
<td>0</td>
<td></td>
<td></td>
<td>çŠ¶æ€(0:æ­£å¸¸,1:å¤±æ•ˆ)</td>
<td></td>
</tr>
<tr>
<td>visit_count</td>
<td>int</td>
<td>0</td>
<td></td>
<td></td>
<td>çŸ­é“¾æ¥è®¿é—®æ¬¡æ•°</td>
<td></td>
</tr>
<tr>
<td>create_time</td>
<td>timestamp</td>
<td>current_timestamp</td>
<td></td>
<td></td>
<td>åˆ›å»ºæ—¶é—´</td>
<td></td>
</tr>
<tr>
<td>create_by</td>
<td>varchar(100)</td>
<td>unknow</td>
<td></td>
<td></td>
<td>åˆ›å»ºäºº</td>
<td></td>
</tr>
<tr>
<td>update_time</td>
<td>timestamp</td>
<td>current_timestamp</td>
<td></td>
<td></td>
<td>æ›´æ–°æ—¶é—´</td>
<td></td>
</tr>
<tr>
<td>update_by</td>
<td>varchar(100)</td>
<td>unknow</td>
<td></td>
<td></td>
<td>æ›´æ–°äºº</td>
<td></td>
</tr>
</tbody></table>
<h3 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h3><p>çˆ¶è¡¨å»ºè¡¨ SQL å¦‚ä¸‹ï¼š</p>
<pre><code class="sql">drop table if exists public.t_url_mapping;

create table public.t_url_mapping
(
    id          varchar(36) default gen_random_uuid() not null,
    url         varchar(512)                          not null,
    short_url   varchar(6),
    expire_time timestamp,
    status      int         default 0,
    visit_count int         default 0,
    create_time timestamp   default current_timestamp,
    create_by   varchar(100),
    update_time timestamp   default current_timestamp,
    update_by   varchar(100),
    primary key (id, create_time)
) partition by range (create_time);

comment on table public.t_url_mapping is &#39;çŸ­é“¾æ¥æ˜ å°„è¡¨&#39;;
comment on column public.t_url_mapping.id is &#39;ä¸»é”®&#39;;
comment on column public.t_url_mapping.url is &#39;åŸå§‹é“¾æ¥&#39;;
comment on column public.t_url_mapping.short_url is &#39;çŸ­é“¾æ¥&#39;;
comment on column public.t_url_mapping.expire_time is &#39;è¿‡æœŸæ—¶é—´&#39;;
comment on column public.t_url_mapping.status is &#39;çŠ¶æ€(0:æ­£å¸¸,1:å¤±æ•ˆ)&#39;;
comment on column public.t_url_mapping.visit_count is &#39;è®¿é—®æ¬¡æ•°&#39;;
comment on column public.t_url_mapping.create_time is &#39;åˆ›å»ºæ—¶é—´&#39;;
comment on column public.t_url_mapping.create_by is &#39;åˆ›å»ºäºº&#39;;
comment on column public.t_url_mapping.update_time is &#39;æ›´æ–°æ—¶é—´&#39;;
comment on column public.t_url_mapping.update_by is &#39;æ›´æ–°äºº&#39;;
</code></pre>
<p>åˆ›å»ºåˆ†åŒºè¡¨å¹¶åœ¨æ—¶é—´å­—æ®µä¸ŠåŠ ç´¢å¼•ï¼š</p>
<pre><code class="sql">drop table if exists public.t_url_mapping_20240413_to_20240417;
drop index if exists idx_t_url_mapping_create_time;
drop index if exists uk_t_url_mapping_short_url;

-- åˆ›å»ºåˆ†è¡¨
create table if not exists public.t_url_mapping_20240413_to_20240417
    partition of public.t_url_mapping
        for values from (&#39;2024-04-13&#39;) to (&#39;2024-04-17&#39;);
-- åˆ›å»ºåˆ†è¡¨åˆ†åŒºå­—æ®µç´¢å¼•
create index idx_t_url_mapping_create_time on public.t_url_mapping_20240413_to_20240417 (create_time);
-- åˆ›å»ºå”¯ä¸€ç´¢å¼•
create unique index if not exists uk_t_url_mapping_short_url on public.t_url_mapping_20240413_to_20240417 (short_url);
</code></pre>
<p>pg10 å·²ç»å¯¹åˆ†åŒºè¡¨çš„æ”¯æŒå·²ç»å¾ˆå¥½äº†ï¼Œç½‘ä¸Šä¸€äº›èµ„æ–™ä¸­ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼åˆ›å»ºåˆ†åŒºè¡¨å·²ç»å¾ˆè¿‡æ—¶äº†ã€‚</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/110927990">å®æˆ˜ PostgreSQL åˆ†åŒºè¡¨</a></p>
<h3 id="å®ç°åˆ†åŒºè¡¨åˆ›å»ºè‡ªåŠ¨åŒ–"><a href="#å®ç°åˆ†åŒºè¡¨åˆ›å»ºè‡ªåŠ¨åŒ–" class="headerlink" title="å®ç°åˆ†åŒºè¡¨åˆ›å»ºè‡ªåŠ¨åŒ–"></a>å®ç°åˆ†åŒºè¡¨åˆ›å»ºè‡ªåŠ¨åŒ–</h3><p>éœ€è¦ä½¿ç”¨è§¦å‘å™¨ï¼Œåœ¨æ‰§è¡Œæ’å…¥æ“ä½œæ—¶å¦‚æœå‘ç°åˆ†åŒºè¡¨ä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆ›å»ºå¯¹åº”çš„åˆ†åŒºè¡¨ã€‚</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/shijiehaiyang/p/17406142.html">postgresql è‡ªåŠ¨åˆ›å»ºåˆ†åŒºè¡¨</a></p>
<h2 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h2><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><ul>
<li>Postgresql 16</li>
<li>Redis 7.2</li>
</ul>
<h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><ul>
<li>JDK17</li>
<li>Springboot 3.1.x</li>
</ul>
<h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><ul>
<li>Nginx 1.24.0</li>
<li>Vue3</li>
<li>Bootstrap5</li>
<li>Webpack</li>
</ul>
<h3 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h3><ul>
<li>Docker</li>
</ul>
<h2 id="ä½¿ç”¨-Docker-éƒ¨ç½²æ•°æ®åº“"><a href="#ä½¿ç”¨-Docker-éƒ¨ç½²æ•°æ®åº“" class="headerlink" title="ä½¿ç”¨ Docker éƒ¨ç½²æ•°æ®åº“"></a>ä½¿ç”¨ Docker éƒ¨ç½²æ•°æ®åº“</h2><p>åˆ›å»º 3 ä¸ªæŒä¹…åŒ–æ•°æ®å·ï¼Œshorturl00 ä¸ºä¸»åº“ï¼Œå…¶ä»–ä¸¤ä¸ªä¸ºä»åº“ã€‚</p>
<pre><code class="sh">docker create volume shorturl00
docker create volume shorturl01
docker create volume shorturl02
</code></pre>
<p>åˆ›å»ºç½‘ç»œ</p>
<pre><code class="sh">docker network create --subnet 172.12.0.0/16 --gateway 172.12.0.1 postgresqlnet
</code></pre>
<p>æ‹‰å–é•œåƒ</p>
<pre><code class="sh">docker pull postgres
</code></pre>
<p>è¿è¡Œå®¹å™¨</p>
<pre><code class="sh">docker run -id --name=shorturl00 --network postgresqlnet --network-alias shorturl00 --ip 172.12.0.2 -v shorturl00:/var/lib/postgresql/data -p 5440:5440 -e POSTGRES_PASSWORD=12345678 -e LANG=C.UTF-8 postgres

docker run -id --name=shorturl01 --network postgresqlnet --network-alias shorturl01 --ip 172.12.0.3 -v shorturl01:/var/lib/postgresql/data -p 5441:5441 -e POSTGRES_PASSWORD=12345678 -e LANG=C.UTF-8 postgres

docker run -id --name=shorturl02 --network postgresqlnet --network-alias shorturl02 --ip 172.12.0.4 -v shorturl02:/var/lib/postgresql/data -p 5442:5442 -e POSTGRES_PASSWORD=12345678 -e LANG=C.UTF-8 postgres
</code></pre>
<p>è¿›å…¥å®¹å™¨ &#x2F;var&#x2F;lib&#x2F;postgresql&#x2F;data ç›®å½•ä¿®æ”¹ pg_hba.conf ç«¯å£</p>
<pre><code>port=5440
</code></pre>
<p>ä¿®æ”¹ pg_hba.conf å…è®¸å¤–éƒ¨è¿æ¥</p>
<pre><code># IPv4 local connections:
host    all             all             0.0.0.0/0               trust
</code></pre>
<p>åœ¨å®¹å™¨å†…åˆ›å»ºæ•°æ®åº“ shorturlï¼Œå¤–éƒ¨è¿æ¥æµ‹è¯•ã€‚</p>
<p>æ³¨ï¼šåœ¨å®¹å™¨å†…ç¼–è¾‘é…ç½®æ–‡ä»¶éœ€è¦ç”¨åˆ° vimï¼Œæ›¿æ¢ä¸€ä¸‹è½¯ä»¶æºé€Ÿåº¦ä¼šæ›´å¿«ã€‚</p>
<pre><code class="sh">cd /etc/apt
mv sources.list.d sources.list.d.bak
# ä½¿ç”¨ä¸­ç§‘å¤§çš„æºï¼Œå¹¶ä¸”ä¸è¦ç”¨ httpsï¼Œä¸ç„¶ä¼šæŠ¥è¯ä¹¦é”™è¯¯
echo &#39;
deb http://mirrors.ustc.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
deb-src http://mirrors.ustc.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
deb http://mirrors.ustc.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
deb-src http://mirrors.ustc.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
deb http://mirrors.ustc.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
deb-src http://mirrors.ustc.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
deb http://mirrors.ustc.edu.cn/debian-security/ bookworm-security main contrib non-free non-free-firmware
deb-src http://mirrors.ustc.edu.cn/debian-security/ bookworm-security main contrib non-free non-free-firmware
&#39; &gt; sources.list
apt-get update
</code></pre>
<h2 id="Docker-éƒ¨ç½²-Postgresql"><a href="#Docker-éƒ¨ç½²-Postgresql" class="headerlink" title="Docker éƒ¨ç½² Postgresql"></a>Docker éƒ¨ç½² Postgresql</h2><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>ä½¿ç”¨ç¼“å­˜æé«˜æ€§èƒ½ã€‚ç”Ÿæˆæ–°çš„çŸ­é“¾æ¥å†™å…¥æ•°æ®åº“çš„åŒæ—¶å†™å…¥ç¼“å­˜ä¸­ï¼Œè®¿é—®çŸ­é“¾æ¥æ—¶é¦–å…ˆä»ç¼“å­˜ä¸­è·å–ï¼Œç¼“å­˜ä¸­è·å–ä¸åˆ°å†ä»æ•°æ®åº“ä¸­è·å–ï¼Œè·å–æˆåŠŸåå°†å…¶æ”¾å…¥ç¼“å­˜ä¸­ã€‚</p>
<p>ä½¿ç”¨ Redis åšä¸ºç¼“å­˜ä¸­é—´ä»¶ï¼Œç¼“å­˜å¤§å°è®¾ç½®ä¸º 1G</p>
<p>1G &#x2F; 782 byte &#x3D; 137 ä¸‡</p>
<p>137 ä¸‡ &#x2F; 10æ¡ &#x2F; s</p>
<p>ç¼“å­˜è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º 1 å¤©ã€‚</p>
<h2 id="åç«¯æ¥å£è®¾è®¡"><a href="#åç«¯æ¥å£è®¾è®¡" class="headerlink" title="åç«¯æ¥å£è®¾è®¡"></a>åç«¯æ¥å£è®¾è®¡</h2><h3 id="çŸ­é“¾ç”Ÿæˆæ¥å£"><a href="#çŸ­é“¾ç”Ÿæˆæ¥å£" class="headerlink" title="çŸ­é“¾ç”Ÿæˆæ¥å£"></a>çŸ­é“¾ç”Ÿæˆæ¥å£</h3><p>æ¥å£åï¼šapi&#x2F;v1&#x2F;shortenURL</p>
<p>è¯·æ±‚æ–¹å¼ï¼šGET</p>
<p>å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>sign</td>
<td>è¯·æ±‚ç­¾åï¼ˆå¯¹å‚æ•°è¿›è¡Œç¼–ç ï¼‰</td>
</tr>
<tr>
<td>URL</td>
<td>åŸå§‹URL</td>
</tr>
</tbody></table>
<p>è¿”å›å€¼ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>0:å¤„ç†æˆåŠŸ,-1:å¤„ç†å¤±è´¥</td>
</tr>
<tr>
<td>message</td>
<td>å¤„ç†ç»“æœ</td>
</tr>
<tr>
<td>data: shortURL</td>
<td>çŸ­é“¾æ¥</td>
</tr>
</tbody></table>
<h3 id="çŸ­é“¾ç»Ÿè®¡æ•°æ®æ¥å£"><a href="#çŸ­é“¾ç»Ÿè®¡æ•°æ®æ¥å£" class="headerlink" title="çŸ­é“¾ç»Ÿè®¡æ•°æ®æ¥å£"></a>çŸ­é“¾ç»Ÿè®¡æ•°æ®æ¥å£</h3><p>æ¥å£åï¼šapi&#x2F;v1&#x2F;statistics</p>
<p>è¯·æ±‚æ–¹å¼ï¼šGET</p>
<p>å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>sign</td>
<td>è¯·æ±‚ç­¾å</td>
</tr>
</tbody></table>
<p>è¿”å›å€¼ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>è¿”å› 0 æ—¶æˆåŠŸï¼Œå¦åˆ™å¤±è´¥</td>
</tr>
<tr>
<td>message</td>
<td>å¤„ç†ç»“æœ</td>
</tr>
<tr>
<td>data:</td>
<td></td>
</tr>
<tr>
<td>totalCount</td>
<td>å…±ç”ŸæˆçŸ­é“¾æ¡æ•°</td>
</tr>
</tbody></table>
<h3 id="çŸ­é“¾è®¿é—®æ¥å£"><a href="#çŸ­é“¾è®¿é—®æ¥å£" class="headerlink" title="çŸ­é“¾è®¿é—®æ¥å£"></a>çŸ­é“¾è®¿é—®æ¥å£</h3><p>æ¥å£åï¼šapi&#x2F;v1&#x2F;visitShortURL</p>
<p>è¯·æ±‚æ–¹å¼ï¼šGET</p>
<p>å‚æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>shortURL</td>
<td>çŸ­é“¾æ¥</td>
</tr>
</tbody></table>
<p>è¿”å›å€¼ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>code</td>
<td>301:è·³è½¬,-1:å¤„ç†å¤±è´¥</td>
</tr>
<tr>
<td>message</td>
<td>å¤„ç†ç»“æœ</td>
</tr>
<tr>
<td>data:</td>
<td></td>
</tr>
<tr>
<td>URL</td>
<td>åŸå§‹URL</td>
</tr>
</tbody></table>
<h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><h3 id="æ•°æ®åº“é«˜å¯ç”¨"><a href="#æ•°æ®åº“é«˜å¯ç”¨" class="headerlink" title="æ•°æ®åº“é«˜å¯ç”¨"></a>æ•°æ®åº“é«˜å¯ç”¨</h3><p>ä¸€ä¸»ä¸¤ä»ï¼Œä¸»ä»å¤åˆ¶ï¼Œä¸»åº“å†™ï¼Œä»åº“è¯»ã€‚</p>
<h3 id="åç«¯æœåŠ¡é«˜å¯ç”¨"><a href="#åç«¯æœåŠ¡é«˜å¯ç”¨" class="headerlink" title="åç«¯æœåŠ¡é«˜å¯ç”¨"></a>åç«¯æœåŠ¡é«˜å¯ç”¨</h3><p>åç«¯æœåŠ¡åˆ†å¸ƒå¼éƒ¨ç½²ï¼ŒNginxåšè´Ÿè½½å‡è¡¡ã€‚</p>
<h2 id="nginx-é…ç½®"><a href="#nginx-é…ç½®" class="headerlink" title="nginx é…ç½®"></a>nginx é…ç½®</h2><p>å‰ç«¯é€šè¿‡ nginx å°†å‰ç«¯è¯·æ±‚è½¬å‘è‡³åç«¯ï¼Œåç«¯åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹ï¼Œé€šè¿‡ nginx å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<p>docker éƒ¨ç½² nginx å‚è€ƒæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/BThinker/article/details/123507820">Docker å®‰è£… Nginx å®¹å™¨ (å®Œæ•´è¯¦ç»†ç‰ˆ)</a> </p>
<h3 id="é•œåƒæ‹‰å–"><a href="#é•œåƒæ‹‰å–" class="headerlink" title="é•œåƒæ‹‰å–"></a>é•œåƒæ‹‰å–</h3><pre><code class="sh">docker pull nginx:latest
</code></pre>
<h3 id="å‡†å¤‡é…ç½®æ–‡ä»¶"><a href="#å‡†å¤‡é…ç½®æ–‡ä»¶" class="headerlink" title="å‡†å¤‡é…ç½®æ–‡ä»¶"></a>å‡†å¤‡é…ç½®æ–‡ä»¶</h3><p>nginx é…ç½®æ–‡ä»¶æ”¾åœ¨å®¿ä¸»æœºç®¡ç†ï¼Œå¯åŠ¨å®¹å™¨ï¼Œnginx ä¼šç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ï¼Œå°†å®¹å™¨ä¸­çš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœºè‡ªå®šä¹‰ç›®å½•ä¸­ã€‚</p>
<pre><code class="sh">docker run -dp 80:80 --name nginx nginx
</code></pre>
<p>å»ºç«‹æœ¬åœ° nginx é…ç½®æ–‡ä»¶å¤¹ï¼š</p>
<pre><code class="sh">mkdir /home/lozhu/Documents/nginx_config/conf

mkdir /home/lozhu/Documents/nginx_config/html

mkdir /home/lozhu/Documents/nginx_config/log
</code></pre>
<p>æ‹·è´é…ç½®æ–‡ä»¶è‡³å®¿ä¸»æœºï¼š</p>
<pre><code class="sh">docker cp nginx:/etc/nginx/nginx.conf /home/lozhu/Documents/nginx_config/conf

docker cp nginx:/etc/nginx/html /home/lozhu/Documents/nginx_config/html

docker cp nginx:/etc/nginx/conf.d /home/lozhu/Documents/nginx_config/conf
</code></pre>
<h3 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h3><p>å…ˆåˆ é™¤ä¹‹å‰å¯åŠ¨çš„å®¹å™¨ï¼š</p>
<pre><code class="sh">docker stop nginx

docker rm nginx
</code></pre>
<p>ä¸ºäº†åé¢ nginx èƒ½å°†è¯·æ±‚è½¬å‘è‡³åç«¯æ¥å£ï¼Œå°† nginx å’Œæ•°æ®åº“å®¹å™¨ã€åç«¯æœåŠ¡å®¹å™¨æ”¾åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ã€‚</p>
<pre><code class="sh">docker run -dp 80:80 \
--name nginx \
--network postgresqlnet \
--ip 172.12.0.10 \
-v /home/lozhu/Documents/nginx_config/conf/nginx.conf:/etc/nginx/nginx.conf \
-v /home/lozhu/Documents/nginx_config/conf/conf.d:/etc/nginx/conf.d \
-v /home/lozhu/Documents/nginx_config/html:/usr/share/nginx/html \
nginx:latest
</code></pre>
<p>å°æ’æ›²ï¼šå®¹å™¨å¯åŠ¨æ—¶è·¯å¾„ &#x2F;home&#x2F;lozhu&#x2F;Documents&#x2F;nginx_config&#x2F;conf&#x2F;conf.d é”™å†™ä¸º &#x2F;home&#x2F;lozhu&#x2F;Documents&#x2F;nginx_config&#x2F;conf.dï¼Œå°‘äº†ä¸€å±‚ confï¼Œå®¹å™¨å¯åŠ¨åæ— æ³•è®¿é—®ï¼š</p>
<pre><code>$ curl http://localhost
curl: (56) Recv failure: Connection reset by peer
</code></pre>
<p>è·¯å¾„ä¿®æ­£åå†å¯åŠ¨å°±å¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚</p>
<h2 id="å‰ç«¯é¡¹ç›®"><a href="#å‰ç«¯é¡¹ç›®" class="headerlink" title="å‰ç«¯é¡¹ç›®"></a>å‰ç«¯é¡¹ç›®</h2><p>æœ¬æ¥æƒ³è¶æ­¤æœºä¼šå­¦ä¹ ä¸€ä¸‹ React å’Œ Next.js ï¼Œä½†æ˜¯å‘ç° Next.js ç›¸å…³çš„å…¥é—¨ä¸­æ–‡èµ„æ–™å¤ªå°‘ï¼Œä¸­æ–‡ç½‘ç«™ä¸Šç¿»è¯‘éƒ½ä¸å…¨ã€‚ä¸€ä¸ªç‚¹å‡»æŒ‰é’®è°ƒç”¨åç«¯æ¥å£è·å–æ•°æ®çš„ä¾‹å­éƒ½å¾ˆéš¾æ‰¾åˆ°ï¼Œè¿˜æ˜¯åˆ°äº† stackoverflow ä¸Šæ‰çœ‹åˆ°æœ‰äººè´´äº†è‹±æ–‡å®˜ç½‘çš„æ–‡æ¡£ã€‚å›½å†…å„ç§åšå®¢æ–‡ç« ä¸Šæ¥å°±æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ã€å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œéš¾é“ Next.js åšä¸äº†äº¤äº’å—ï¼Ÿç•™åˆ°åé¢å†æ·±å…¥å­¦ä¹ å§ã€‚æ­¤æ¬¡éœ€æ±‚å…ˆä½¿ç”¨ç†Ÿæ‚‰çš„ Vue.js æ¥å®ç°ã€‚</p>
<h3 id="Vue-é¡¹ç›®æ­å»º"><a href="#Vue-é¡¹ç›®æ­å»º" class="headerlink" title="Vue é¡¹ç›®æ­å»º"></a>Vue é¡¹ç›®æ­å»º</h3><p>åˆ›å»ºé¡¹ç›®ï¼š</p>
<pre><code class="sh">vue init webpack shorturl-web
</code></pre>
<h3 id="Axios-é…ç½®"><a href="#Axios-é…ç½®" class="headerlink" title="Axios é…ç½®"></a>Axios é…ç½®</h3><p>ä½¿ç”¨çš„ Vue.js ç‰ˆæœ¬æ˜¯ 2.5.2ï¼Œå¦‚æœå®‰è£… axios æœ€æ–°ç‰ˆæœ¬çš„è¯é¡¹ç›®å¯åŠ¨ä¼šæŠ¥é”™ï¼š</p>
<pre><code>in ../node_modules/axios/lib/platform/index.js
</code></pre>
<p>è§£å†³æ–¹æ³•æ˜¯å°†ä½ axios ç‰ˆæœ¬ï¼Œå…ˆåˆ é™¤ node_modules ç›®å½•ï¼Œç„¶åå°† package.json ä¸­ axios ç‰ˆæœ¬æ”¹ä¸º 1.5.0ï¼Œå†é‡æ–° npm installã€‚</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/AGLQYP/article/details/136199938">Vueå¼•å…¥axiosæŠ¥é”™</a></p>
<p>å…ˆä¿®æ”¹ config&#x2F;index.js ä¸­çš„è·¨åŸŸè®¾ç½®ï¼š</p>
<pre><code class="js">module.exports = &#123;
  dev: &#123;

    // Paths
    assetsSubDirectory: &#39;static&#39;,
    assetsPublicPath: &#39;/&#39;,
    proxyTable: &#123;
      &#39;^/api&#39;: &#123;
        target: &#39;http://localhost:8000&#39;,
        changeOrigin: true,
        secure: false,
        pathRewrite: &#123;
          &#39;^/api&#39;: &#39;/api&#39;
        &#125;
      &#125;
    &#125;,
    ...
  &#125;
</code></pre>
<p>åœ¨ main.js ä¸­å¼•å…¥ axios</p>
<pre><code class="js">import axios from &#39;axios&#39;

Vue.prototype.$axios = axios
</code></pre>
<h3 id="é¡µé¢ä»£ç å®ç°"><a href="#é¡µé¢ä»£ç å®ç°" class="headerlink" title="é¡µé¢ä»£ç å®ç°"></a>é¡µé¢ä»£ç å®ç°</h3><p>ä¸»è¦ä»£ç ï¼š</p>
<pre><code class="vue">&lt;template&gt;
  &lt;div class=&quot;content&quot;&gt;
    &lt;div class=&quot;main-content&quot;&gt;
      &lt;h2&gt;Lozhu çš„åœ¨çº¿çŸ­é“¾æœåŠ¡&lt;/h2&gt;
      &lt;h4&gt;ç´¯è®¡ç”ŸæˆçŸ­é“¾: &#123;&#123; historyData.length &#125;&#125;&lt;/h4&gt;
      &lt;div class=&quot;input-group mb-3&quot; style=&quot;margin-top: 40px;&quot;&gt;
        &lt;input v-model=&quot;URL&quot; type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;è¯·è¾“å…¥é“¾æ¥ï¼Œä¸€æ¬¡ä¸€ä¸ªå“¦ï½&quot;&gt;
        &lt;button v-on:click=&quot;shortenURL&quot; class=&quot;btn btn-outline-secondary&quot; type=&quot;button&quot; id=&quot;button-addon2&quot;&gt;ğŸš€
          ç”ŸæˆçŸ­é“¾&lt;/button&gt;
      &lt;/div&gt;
      &lt;div v-if=&quot;errorMessage&quot; class=&quot;alert alert-danger fade show&quot; role=&quot;alert&quot;&gt;
        &#123;&#123; errorMessage &#125;&#125;
      &lt;/div&gt;
      &lt;div v-if=&quot;warningMessage&quot; class=&quot;alert alert-warning fade show&quot; role=&quot;alert&quot;&gt;
        &#123;&#123; warningMessage &#125;&#125;
      &lt;/div&gt;
      &lt;div style=&quot;margin-top: 50px;&quot;&gt;
        &lt;table class=&quot;table table-hover&quot;&gt;
          &lt;thead&gt;
            &lt;tr&gt;
              &lt;th&gt;åºå·&lt;/th&gt;
              &lt;th&gt;åŸå§‹é“¾æ¥&lt;/th&gt;
              &lt;th&gt;çŸ­é“¾&lt;/th&gt;
              &lt;th&gt;ç”Ÿæˆæ—¶é—´&lt;/th&gt;
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            &lt;tr v-for=&quot;(item, index) in historyData&quot; :key=&quot;index&quot;&gt;
              &lt;td&gt;&#123;&#123; index + 1 &#125;&#125;&lt;/td&gt;
              &lt;td&gt;
                &lt;a :href=item.URL target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&#123;&#123; item.URL &#125;&#125;&lt;/a&gt;
              &lt;/td&gt;
              &lt;td&gt;
                &lt;a :href=item.shortURL target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&#123;&#123; item.shortURL &#125;&#125;&lt;/a&gt;
              &lt;/td&gt;
              &lt;td&gt;&#123;&#123; item.generateTime &#125;&#125;&lt;/td&gt;
            &lt;/tr&gt;
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;footer&quot;&gt;
      &lt;p&gt;
        &lt;span&gt;
          ğŸ“ &lt;a :href=&quot;documentURL&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt; é¡¹ç›®æ–‡æ¡£&lt;/a&gt;
        &lt;/span&gt;
        |
        &lt;span&gt;
          &lt;a :href=&quot;sourceCodeURL&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;æºç &lt;/a&gt;
        &lt;/span&gt;
      &lt;/p&gt;
      &lt;p&gt;
        &lt;span&gt;
          &lt;div class=&quot;heart&quot;&gt;&lt;/div&gt;
        &lt;/span&gt;
        &lt;span&gt;å·²å‹‰å¼ºè¿è¡Œ &#123;&#123; runningDays &#125;&#125; å¤©&lt;/span&gt;
      &lt;/p&gt;
      &lt;p&gt;Â©ï¸ 2024 lozhu ä¿ç•™æ‰€æœ‰æƒåˆ©&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default &#123;
  name: &#39;Home&#39;,
  data() &#123;
    return &#123;
      URL: &#39;&#39;,
      shortURL: &#39;&#39;,
      errorMessage: &#39;&#39;,
      warningMessage: &#39;&#39;,
      totalCount: 0,
      runningDays: 0,
      historyData: [],
      documentURL: &#39;https://lozhu.happy365.day&#39;,
      sourceCodeURL: &#39;https://lozhu.happy365.day&#39;
    &#125;
  &#125;,
  created() &#123;
    let nowTime = new Date().getTime() / 1000
    // å¼€å§‹è¿è¡Œæ—¶é—´: 2024-04-12
    let startTime = new Date(2024, 3, 12).getTime() / 1000
    let days = (nowTime - startTime) / (60 * 60 * 24)
    this.runningDays = parseInt(days + &#39;&#39;)
  &#125;,
  methods: &#123;
    shortenURL() &#123;
      this.warningMessage = &#39;&#39;
      this.errorMessage = &#39;&#39;
      if (this.URL === &#39;&#39;) &#123;
        this.warningMessage = &#39;è¯·å…ˆè¾“å…¥é“¾æ¥å“¦ï½&#39;
        return false
      &#125;
      this.$axios.get(&#39;/api/v1/shortenURL&#39;, &#123;
        params: &#123;
          URL: this.URL,
          sign: &#39;&#39;
        &#125;
      &#125;).then((res) =&gt; &#123;
        if (res.data &amp;&amp; res.data.code === 0) &#123;
          let tableRow = &#123;
            URL: this.URL,
            shortURL: res.data.data,
            generateTime: this.formatDateTime(new Date())
          &#125;
          this.historyData.push(tableRow)
        &#125; else &#123;
          this.errorMessage = res.data.message
        &#125;
        this.URL = &#39;&#39;
      &#125;).catch((err) =&gt; &#123;
        this.errorMessage = &#39;å½“å‰æœåŠ¡ä¸å¯ç”¨&#39;
        this.warningMessage = &#39;&#39;
      &#125;)
    &#125;,
    formatDateTime(date) &#123;
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hour = date.getHours();
      const minute = date.getMinutes();
      const second = date.getSeconds();
      return `$&#123;year&#125;-$&#123;this.pad(month)&#125;-$&#123;this.pad(day)&#125; $&#123;this.pad(hour)&#125;:$&#123;this.pad(minute)&#125;:$&#123;this.pad(second)&#125;`;
    &#125;,
    pad(num) &#123;
      return num.toString().padStart(2, &#39;0&#39;);
    &#125;
  &#125;
&#125;
&lt;/script&gt;

&lt;style scoped&gt;
&lt;/style&gt;
</code></pre>
<p>æ ·å¼ç›´æ¥å¼•å…¥ Bootstrap å®ç°ã€‚CSS ä»£ç çœç•¥ã€‚</p>
<h3 id="æ‰“åŒ…éƒ¨ç½²è‡³-nginx"><a href="#æ‰“åŒ…éƒ¨ç½²è‡³-nginx" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²è‡³ nginx"></a>æ‰“åŒ…éƒ¨ç½²è‡³ nginx</h3><p>æ‰“åŒ…ï¼š</p>
<pre><code class="sh">npm run build
</code></pre>
<p>æ‰“åŒ…å®Œæˆä¹‹åï¼Œå°† dist è·¯å¾„ä¸‹çš„ index.html å’Œ static ä¸¤ä¸ªæ–‡ä»¶æ‹·è´è‡³ docker nginx æ˜ å°„çš„å®¿ä¸»æœº html ç›®å½•ä¸‹ï¼Œè®¿é—®å®¿ä¸»æœº 80 ç«¯å£ï¼Œå³å¯çœ‹åˆ°é¡µé¢ã€‚</p>
<h3 id="Docker-é•œåƒç”Ÿæˆ"><a href="#Docker-é•œåƒç”Ÿæˆ" class="headerlink" title="Docker é•œåƒç”Ÿæˆ"></a>Docker é•œåƒç”Ÿæˆ</h3><pre><code class="dockerfile">FROM nginx:1.22

EXPOSE 80

COPY /dist /usr/share/nginx/html

ENTRYPOINT nginx -g &quot;daemon off;&quot;
</code></pre>
<p>å¯èƒ½æ˜¯æˆ‘è‡ªå·±ç”µè„‘æ€§èƒ½æ¯”è¾ƒä½çš„åŸå› ï¼Œæ‰“åŒ…æ¯”è¾ƒæ…¢ï¼Œè¦å¥½å‡ åˆ†é’Ÿæ‰èƒ½è·‘å®Œã€‚</p>
<pre><code class="sh">docker build -t chenxii81/shorturl-web-image:v1.1.0 .
</code></pre>
<p>æ‰“åŒ…å®Œæˆåæ¨é€è‡³ Docker Hubï¼š</p>
<pre><code class="sh">docker push chenxii81/shorturl-web-image:v1.1.0
</code></pre>
<p>è¿è¡Œå®¹å™¨ï¼š</p>
<pre><code class="sh">docker run -dp 3000:80 --name shorturl-web --network postgresqlnet --ip 172.12.0.10 chenxii81/shorturl-web-image:v1.1.0
</code></pre>
<p>è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a> å¯ä»¥çœ‹åˆ°é¦–é¡µã€‚</p>
<p>nginx è½¬å‘é…ç½®å‚è€ƒä¸‹æ–‡ã€‚</p>
<h2 id="Springboot-MyBatis-å¤šæ•°æ®æºé…ç½®"><a href="#Springboot-MyBatis-å¤šæ•°æ®æºé…ç½®" class="headerlink" title="Springboot + MyBatis å¤šæ•°æ®æºé…ç½®"></a>Springboot + MyBatis å¤šæ•°æ®æºé…ç½®</h2><p>é¦–å…ˆå¼•å…¥æ•°æ®åº“é…ç½®ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
    &lt;version&gt;3.5.11&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
    &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;
&lt;!-- ä½¿ç”¨ aop + æ³¨è§£ çš„æ–¹å¼åŠ¨æ€åˆ‡æ¢æ•°æ®æº --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>å®ä½“ç±»å®šä¹‰ï¼š</p>
<pre><code class="java">@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class UrlMapping &#123;

    private String id;

    private String url;

    private String shortUrl;

    private Date expireTime;

    private int status = 0;

    private Date createTime = new Date();

    private String createBy = &quot;system&quot;;

    private Date updateTime = new Date();

    private String updateBy = &quot;system&quot;;

&#125;
</code></pre>
<p>æ•°æ®åº“è®¿é—®æ¥å£ï¼š</p>
<pre><code class="java">@Mapper
public interface UrlMappingDao &#123;

    int insert(UrlMapping urlMapping);

    UrlMapping selectByShortUrl(String shortURL);

    /**
     * æ›´æ–°è¿‡æœŸé“¾æ¥çš„æœ‰æ•ˆæ€§
     *
     * @return è¢«æ›´æ–°çš„çŸ­é“¾æ•°é‡
     */
    int updateStatusByExpireTime();

&#125;
</code></pre>
<pre><code class="java">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;day.happy365.shorturlservice.dao.UrlMappingDao&quot;&gt;

    &lt;resultMap id=&quot;BaseResultMap&quot; type=&quot;day.happy365.shorturlservice.entity.UrlMapping&quot;&gt;
        &lt;id property=&quot;id&quot; column=&quot;id&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
        &lt;result property=&quot;url&quot; column=&quot;url&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
        &lt;result property=&quot;shortUrl&quot; column=&quot;short_url&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
        &lt;result property=&quot;expireTime&quot; column=&quot;expire_time&quot; jdbcType=&quot;TIMESTAMP&quot;/&gt;
        &lt;result property=&quot;status&quot; column=&quot;status&quot; jdbcType=&quot;INTEGER&quot;/&gt;
        &lt;result property=&quot;createTime&quot; column=&quot;create_time&quot; jdbcType=&quot;TIMESTAMP&quot;/&gt;
        &lt;result property=&quot;createBy&quot; column=&quot;create_by&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
        &lt;result property=&quot;updateTime&quot; column=&quot;update_time&quot; jdbcType=&quot;TIMESTAMP&quot;/&gt;
        &lt;result property=&quot;updateBy&quot; column=&quot;update_by&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
    &lt;/resultMap&gt;

    &lt;sql id=&quot;Base_Column_List&quot;&gt;
        id,url,short_url,
        expire_time,status,create_time,
        create_by,update_time,update_by
    &lt;/sql&gt;

    &lt;insert id=&quot;insert&quot; parameterType=&quot;day.happy365.shorturlservice.entity.UrlMapping&quot;&gt;
        insert into public.t_url_mapping(url, short_url, expire_time, create_by, update_by)
        values (#&#123;url&#125;,
                #&#123;shortUrl&#125;,
                #&#123;expireTime&#125;,
                #&#123;createBy&#125;,
                #&#123;updateBy&#125;);
    &lt;/insert&gt;

    &lt;update id=&quot;updateStatusByExpireTime&quot;&gt;
        update public.t_url_mapping
        set status = 1,
            update_time = now(),
            update_by = &#39;ExpiredURLCheckJob&#39;
        where expire_time &lt;![CDATA[ &lt;= ]]&gt; now()::timestamp
    &lt;/update&gt;

    &lt;select id=&quot;selectByShortUrl&quot; resultMap=&quot;BaseResultMap&quot;&gt;
        select
        &lt;include refid=&quot;Base_Column_List&quot;/&gt;
        from public.t_url_mapping
        where short_url = #&#123;shortURL&#125;
        order by create_time desc
        limit 1
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>
<p>æ•°æ®åº“é…ç½®ï¼š</p>
<pre><code class="yaml">spring:
  application:
    name: shorturl-service
  datasource:
    # ä¸»åº“ï¼Œç”¨äºå†™
    shorturl00:
      jdbc-url: jdbc:postgresql://vm1:5440/shorturl
      username: postgres
      password: *******
      driver-class-name: org.postgresql.Driver
    # ä»åº“1ï¼Œç”¨äºè¯»
    shorturl01:
      jdbc-url: jdbc:postgresql://vm1:5441/shorturl
      username: postgres
      password: *******
      driver-class-name: org.postgresql.Driver
    # ä»åº“2ï¼Œç”¨äºè¯»
    shorturl02:
      jdbc-url: jdbc:postgresql://vm1:5442/shorturl
      username: postgres
      password: *******
      driver-class-name: org.postgresql.Driver
</code></pre>
<p>æ•°æ®æºé…ç½®ç±»ï¼š</p>
<pre><code class="java">/**
 * ä¸»ä»æ•°æ®æºé…ç½®
 */
@Configuration
@EnableTransactionManagement
@MapperScan(basePackages = &quot;day.happy365.shorturlservice.dao&quot;, sqlSessionFactoryRef = &quot;sqlSessionFactory&quot;)
public class DataSourceConfig &#123;

    @Bean(name = &quot;masterDataSource&quot;)
    @Primary
    @ConfigurationProperties(prefix = &quot;spring.datasource.shorturl00&quot;)
    public DataSource masterDataSource() &#123;
        return DataSourceBuilder.create().build();
    &#125;

    @Bean(name = &quot;slaveDataSource1&quot;)
    @ConfigurationProperties(prefix = &quot;spring.datasource.shorturl01&quot;)
    public DataSource slaveDataSource1() &#123;
        return DataSourceBuilder.create().build();
    &#125;

    @Bean(name = &quot;slaveDataSource2&quot;)
    @ConfigurationProperties(prefix = &quot;spring.datasource.shorturl02&quot;)
    public DataSource slaveDataSource2() &#123;
        return DataSourceBuilder.create().build();
    &#125;

    @Primary
    @Bean(&quot;dynamicDataSource&quot;)
    public DynamicRoutingDataSource dynamicDataSource(@Qualifier(value = &quot;masterDataSource&quot;) DataSource masterDataSource,
                                                      @Qualifier(value = &quot;slaveDataSource1&quot;) DataSource slaveDataSource1,
                                                      @Qualifier(value = &quot;slaveDataSource2&quot;) DataSource slaveDataSource2) &#123;
        Map&lt;Object, Object&gt; targetDataSources = new HashMap&lt;&gt;(3);
        targetDataSources.put(DynamicRoutingDataSourceContext.MASTER, masterDataSource);
        targetDataSources.put(DynamicRoutingDataSourceContext.SLAVE1, slaveDataSource1);
        targetDataSources.put(DynamicRoutingDataSourceContext.SLAVE2, slaveDataSource2);
        DynamicRoutingDataSource dynamicRoutingDataSource = new DynamicRoutingDataSource();
        // è®¾ç½®æ•°æ®æº
        dynamicRoutingDataSource.setTargetDataSources(targetDataSources);
        // è®¾ç½®é»˜è®¤é€‰æ‹©çš„æ•°æ®æº
        dynamicRoutingDataSource.setDefaultTargetDataSource(masterDataSource);
        dynamicRoutingDataSource.afterPropertiesSet();
        return dynamicRoutingDataSource;
    &#125;

    @Bean(name = &quot;sqlSessionFactory&quot;)
    @Primary
    public SqlSessionFactory sqlSessionFactory(@Qualifier(&quot;dynamicDataSource&quot;) DataSource dynamicDataSource) throws Exception &#123;
        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
        bean.setDataSource(dynamicDataSource);
        bean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(&quot;classpath:**/*.xml&quot;));
        return bean.getObject();
    &#125;

&#125;
</code></pre>
<p>ç»´æŠ¤ä¸€ä¸ªæ•°æ®æº Mapï¼š</p>
<pre><code class="java">public class DynamicRoutingDataSourceContext &#123;

    public static final String MASTER = &quot;master&quot;;

    public static final String SLAVE1 = &quot;slave1&quot;;

    public static final String SLAVE2 = &quot;slave2&quot;;

    private static final ThreadLocal&lt;String&gt; THREAD_LOCAL_DATA_SOURCE = new ThreadLocal&lt;&gt;();

    public static void setRoutingDataSource(String dataSource) &#123;
        if (dataSource == null) &#123;
            throw new NullPointerException();
        &#125;
        THREAD_LOCAL_DATA_SOURCE.set(dataSource);
    &#125;

    public static String getRoutingDataSource() &#123;
        String dataSourceType = THREAD_LOCAL_DATA_SOURCE.get();
        if (dataSourceType == null) &#123;
            THREAD_LOCAL_DATA_SOURCE.set(DynamicRoutingDataSourceContext.MASTER);
            return getRoutingDataSource();
        &#125;
        return dataSourceType;
    &#125;

    public static void removeRoutingDataSource() &#123;
        THREAD_LOCAL_DATA_SOURCE.remove();
    &#125;
&#125;
</code></pre>
<p>ç»§æ‰¿ AbstractRoutingDataSource ç±»å®ç° determineCurrentLookupKey æ–¹æ³•ï¼š</p>
<pre><code class="java">public class DynamicRoutingDataSource extends AbstractRoutingDataSource &#123;

    @Override
    protected Object determineCurrentLookupKey() &#123;
        String routingDataSource = DynamicRoutingDataSourceContext.getRoutingDataSource();
        log.info(&quot;ã€åŠ¨æ€æ•°æ®æºã€‘æœ¬æ¬¡ä½¿ç”¨æ•°æ®åº“: &#123;&#125;&quot;, routingDataSource);
        return routingDataSource;
    &#125;

&#125;
</code></pre>
<p>å¢åŠ ä¸€ä¸ª TargetDataSource æ³¨è§£ï¼Œåœ¨æ‰§è¡Œæ•°æ®åº“æ“ä½œæ—¶æŒ‡å®šæ•°æ®åº“ï¼Œä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼š</p>
<pre><code class="java">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)
@Retention(value = RetentionPolicy.RUNTIME)
@Documented
public @interface TargetDataSource &#123;
    String value();
&#125;
</code></pre>
<p>æ ¹æ®è‡ªå®šä¹‰æ³¨è§£çš„å€¼åˆ‡æ¢æ•°æ®æºï¼š</p>
<pre><code class="java">@Order(0)
@Aspect
@Component
public class DataSourceRoutingAopAspect &#123;

    @Around(&quot;@annotation(targetDataSource)&quot;)
    public Object routingWithDataSource(ProceedingJoinPoint joinPoint, TargetDataSource targetDataSource) throws Throwable &#123;
        try &#123;
            String value = targetDataSource.value();
            if (&quot;slave&quot;.equals(value)) &#123;
                if (new Random(7).nextInt() % 2 == 0) &#123;
                    DynamicRoutingDataSourceContext.setRoutingDataSource(DynamicRoutingDataSourceContext.SLAVE1);
                &#125; else &#123;
                    DynamicRoutingDataSourceContext.setRoutingDataSource(DynamicRoutingDataSourceContext.SLAVE2);
                &#125;
            &#125; else &#123;
                DynamicRoutingDataSourceContext.setRoutingDataSource(value);
            &#125;
            return joinPoint.proceed();
        &#125; finally &#123;
            DynamicRoutingDataSourceContext.removeRoutingDataSource();
        &#125;
    &#125;
&#125;
</code></pre>
<p>âš ï¸ æœ€åè¿˜æœ‰æœ€é‡è¦çš„ä¸€æ­¥ï¼Œä»å¯åŠ¨ç±»ä¸Šæ’é™¤ SpringBoot çš„æ•°æ®æºç›¸å…³çš„è‡ªåŠ¨é…ç½®ï¼Œå¦åˆ™ä¼šæŠ¥æ‰¾ä¸åˆ°æ•°æ®åº“é…ç½®çš„é”™è¯¯ã€‚æ²¡æ„è¯†åˆ°è¿™ç‚¹ï¼Œåœ¨è¿™é‡Œå¡äº†åŠä¸ªå°æ—¶ã€‚</p>
<pre><code class="java">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class, DataSourceTransactionManagerAutoConfiguration.class&#125;)
@EnableScheduling
@EnableAsync
public class ShorturlServiceApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(ShorturlServiceApplication.class, args);
    &#125;

&#125;
</code></pre>
<h2 id="Docker-éƒ¨ç½²åç«¯æœåŠ¡"><a href="#Docker-éƒ¨ç½²åç«¯æœåŠ¡" class="headerlink" title="Docker éƒ¨ç½²åç«¯æœåŠ¡"></a>Docker éƒ¨ç½²åç«¯æœåŠ¡</h2><h3 id="jar-åŒ…ç”Ÿæˆ"><a href="#jar-åŒ…ç”Ÿæˆ" class="headerlink" title="jar åŒ…ç”Ÿæˆ"></a>jar åŒ…ç”Ÿæˆ</h3><pre><code class="sh">mvn clean

mvn package -DskipTests
</code></pre>
<h3 id="Dockerfile-ç¼–å†™"><a href="#Dockerfile-ç¼–å†™" class="headerlink" title="Dockerfile ç¼–å†™"></a>Dockerfile ç¼–å†™</h3><pre><code class="dockerfile">FROM openjdk:17-oracle

ADD target/shorturl-service-v1.1.0.jar /shorturl-service-v1.1.0.jar

RUN bash -c &#39;touch /shorturl-service-v1.1.0.jar&#39;

ENV dataSource1Url=&quot;&quot;
ENV dataSource2Url=&quot;&quot;
ENV dataSource3Url=&quot;&quot;
ENV dataSourceUsername=&quot;&quot;
ENV dataSourcePassword=&quot;&quot;
ENV sysConfigDomain=&quot;&quot;

EXPOSE 8000

MAINTAINER chenxii81

ENTRYPOINT [&quot;java&quot;, &quot;-Dspring.datasource.shorturl00.jdbc-url=$&#123;dataSource1Url&#125;&quot;, &quot;-Dspring.datasource.shorturl00.username=$&#123;dataSourceUsername&#125;&quot;, &quot;-Dspring.datasource.shorturl00.password=$&#123;dataSourcePassword&#125;&quot;,  &quot;-Dspring.datasource.shorturl01.jdbc-url=$&#123;dataSource2Url&#125;&quot;, &quot;-Dspring.datasource.shorturl01.username=$&#123;dataSourceUsername&#125;&quot;, &quot;-Dspring.datasource.shorturl01.password=$&#123;dataSourcePassword&#125;&quot;, &quot;-Dspring.datasource.shorturl02.jdbc-url=$&#123;dataSource3Url&#125;&quot;, &quot;-Dspring.datasource.shorturl02.username=$&#123;dataSourceUsername&#125;&quot;, &quot;-Dspring.datasource.shorturl02.password=$&#123;dataSourcePassword&#125;&quot;, &quot;-Dsys.config.domain=$&#123;sysConfigDomain&#125;&quot;, &quot;-jar&quot;, &quot;/shorturl-service-v1.1.0.jar&quot;]
</code></pre>
<p><strong>è¦æ³¨æ„ ENTRYPOINT æ‹¬å·å†…ä¸èƒ½æœ‰æ¢è¡Œã€‚</strong></p>
<h3 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h3><pre><code class="sh">docker build -t chenxii81/shorturl-service-app:v1.1.0 .
</code></pre>
<p>æ¨é€è‡³ Docker Hubï¼š</p>
<pre><code class="sh">docker push chenxii81/shorturl-service-app:v1.1.0   
</code></pre>
<p>è¿è¡Œé•œåƒï¼š</p>
<pre><code class="sh">docker run -d \
--name shorturl-service \
--network postgresqlnet \
--ip 172.12.0.10 \
-e dataSource1Url=&quot;jdbc:postgresql://pg:172.12.0.2:5440/shorturl&quot; \
-e dataSource2Url=&quot;jdbc:postgresql://pg:172.12.0.3:5441/shorturl&quot; \
-e dataSource3Url=&quot;jdbc:postgresql://pg:172.12.0.4:5442/shorturl&quot; \
-e dataSourceUsername=&quot;postgres&quot; \
-e dataSourcePassword=&quot;12345678&quot; \
-e sysConfigDomain=&quot;http://localhost:9000/&quot; \
-p 9000:8000 \
chenxii81/shorturl-service-app:v1.1.0
</code></pre>
<h2 id="nginx-è½¬å‘é…ç½®"><a href="#nginx-è½¬å‘é…ç½®" class="headerlink" title="nginx è½¬å‘é…ç½®"></a>nginx è½¬å‘é…ç½®</h2><p>é…ç½® nginx è¯·æ±‚åç«¯æ¥å£ï¼š</p>
<p>nginx.conf æ–‡ä»¶</p>
<pre><code>user nginx;
worker_processes auto;

error_log /var/log/nginx/error.log notice;
pid /var/run/nginx.pid;

events &#123;
  worker_connections 1024;
&#125;

http &#123;
  include /etc/nginx/mime.types;
  default_type application/octet-stream;
  log_format main &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot;&#39;
                  &#39;$status $body_bytes_sent &quot;$http_referer&quot;&#39;
                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

  access_log /var/log/nginx/access.log main;

  sendfile on;
  #tcp_nopush on;

  keepalive_timeout 65;

  #gzip on;

  upstream www_server_pools &#123;
    server 192.168.1.20:8000 weight=1;
    server 192.168.1.21:8000 weight=1;
  &#125;

  include /etc/nginx/conf.d/*.conf;
&#125;
</code></pre>
<p>conf.d &#x2F; default.conf æ–‡ä»¶ï¼š</p>
<pre><code>server &#123;
  listen 80;
  listen [::]:80;
  server_name localhost;

  # access_log /var/log/nginx/host.access.log main;

  location = / &#123;
    root /usr/share/nginx/html;
    index index.html index.htm;
  &#125;

  location = /index.html &#123;
    root /usr/share/nginx/html;
  &#125;

  location / &#123;
    proxy_pass http://www_server_pools;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  &#125;

  # redirect server error pages to the static page /50x.html
  #

  error_page 500 502 503 504 /50x.html;
  location = /50x.html &#123;
    root /usr/share/nginx/html;
  &#125;
&#125;
</code></pre>
<h2 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h2><p>æŠ¥é”™1ï¼š</p>
<pre><code>***************************
APPLICATION FAILED TO START
***************************

Description:

Failed to configure a DataSource: &#39;url&#39; attribute is not specified and no embedded datasource could be configured.

Reason: Failed to determine a suitable driver class


Action:

Consider the following:
    If you want an embedded database (H2, HSQL or Derby), please put it on the classpath.
    If you have database settings to be loaded from a particular profile you may need to activate it (the profiles dev are currently active).


Process finished with exit code 1
</code></pre>
<p>ç¡®è®¤æ•°æ®åº“é…ç½®æ— è¯¯ï¼Œä½†æ˜¯å¯åŠ¨ä¸€ç›´æŠ¥é”™æ‰¾ä¸åˆ°æ•°æ®åº“ç›¸å…³çš„é…ç½®ã€‚å¯å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39629277/article/details/97782030">Spring booté‡å‘ä¹‹é…ç½®æ•°æ®æºå¯åŠ¨æŠ¥é”™</a></p>
<p>éœ€è¦ä»å¯åŠ¨ç±»ä¸Šæ’é™¤æ•°æ®åº“è‡ªåŠ¨é…ç½®ã€‚</p>
<pre><code class="java">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class, DataSourceTransactionManagerAutoConfiguration.class&#125;)
@EnableScheduling
@EnableAsync
public class ShorturlServiceApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(ShorturlServiceApplication.class, args);
    &#125;

&#125;
</code></pre>
<p>æŠ¥é”™2ï¼š</p>
<pre><code>Caused by: java.io.FileNotFoundException: class path resource [**/*.xml] cannot be opened because it does not exist
</code></pre>
<p>å¯å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.cnblogs.com/jev-0987/p/12839193.html">Springboot é¡¹ç›® æ— æ³•è¯»å–resourcesä¸‹çš„mapperæ–‡ä»¶å¤¹çš„.xmlæ–‡ä»¶</a> ä¸­çš„è¯´æ˜ï¼š</p>
<blockquote>
<p>å…³äºPathMatchingResourcePatternResolver : <a target="_blank" rel="noopener" href="https://www.cnblogs.com/loveLands/articles/9863195.html">https://www.cnblogs.com/loveLands/articles/9863195.html</a><br>æœç„¶getResource å’Œ getResourcesä¸åŒ</p>
<p>getResource()ï¼š<br>1.ä»ç±»çš„æ ¹è·¯å¾„ä¸‹è·å–æ–‡ä»¶<br>getResources():<br>1.è·å–æ‰€æœ‰ç±»è·¯å¾„ä¸‹çš„æŒ‡å®šæ–‡ä»¶<br>å¯ä»¥é€šè¿‡classpath<em>å‰ç¼€æŒ‡å®šï¼Œä»æ‰€æœ‰çš„ç±»è·¯å¾„ä¸‹è·å–æŒ‡å®šæ–‡ä»¶ï¼Œä¸classpathå‰ç¼€çš„åŒºåˆ«æ˜¯classpathå‰ç¼€åªèƒ½è·å–å½“ç±»è·¯å¾„ä¸‹çš„èµ„æºæ–‡ä»¶ï¼Œè€Œclasspath</em>å‰ç¼€å¯ä»¥è·å–æ‰€æœ‰ç±»è·¯å¾„ä¸‹çš„èµ„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬jaråŒ…ä¸­çš„ã€‚</p>
</blockquote>
<p>æŠ¥é”™3ï¼šé¡¹ç›®æ­£å¸¸å¯åŠ¨åè®¿é—®æ¥å£æŠ¥ 404</p>
<p>æ£€æŸ¥äº† Controller ç±»ä¸Š RequestMapping è·¯å¾„å’Œæ–¹æ³•ä¸Šçš„ RequestMapping è·¯å¾„éƒ½æ²¡é—®é¢˜ï¼Œå¯åŠ¨æ—¥å¿—é‡Œçš„å¯åŠ¨ç«¯å£æ­£å¸¸ï¼Œç¡®è®¤ context-path&#x3D;â€™â€™ã€‚æ’æŸ¥äº†åŠå¤©ä¹‹åå‘ç°ï¼Œæ˜¯åˆšæ‰åœ¨è§£å†³æ•°æ®æºå¯åŠ¨æŠ¥é”™æ—¶åœ¨ Application ç±»ä¸ŠåŠ äº† @ComponentScanï¼Œå¹¶ä¸”åªæŒ‡å‘äº† dao çš„è·¯å¾„ï¼Œå¯¼è‡´å…¶ä»– controller bean æ²¡æœ‰åŠ è½½åˆ°å®¹å™¨é‡Œï¼Œåˆ é™¤å¯åŠ¨ç±»ä¸Šçš„ @ComponentScan ä¹‹åé‡å¯é¡¹ç›®ï¼Œå°±èƒ½æ­£å¸¸è®¿é—®åˆ°æ¥å£äº†ã€‚</p>
<p>æŠ¥é”™4ï¼šé€šè¿‡ Docker Desktop æ¨é€å‰ç«¯é¡¹ç›® docker é•œåƒè‡³é•œåƒä»“åº“æ—¶æŠ¥é”™ï¼š</p>
<pre><code>denied: requested access to the resource is denied
</code></pre>
<p>åœ¨ stackoverflow æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼šé•œåƒåç§°éœ€è¦åŒ…å«è‡ªå·±çš„ docker id æ‰èƒ½æ¨é€ã€‚æ”¹ä¸€ä¸‹é•œåƒåç§°ï¼Œé‡æ–°æ‰“åŒ…æ¨é€å³å¯ã€‚</p>
<pre><code>docker build -t your-docker-id/image-name:tag .
</code></pre>
<h2 id="å…¶ä»–é—®é¢˜è®°å½•"><a href="#å…¶ä»–é—®é¢˜è®°å½•" class="headerlink" title="å…¶ä»–é—®é¢˜è®°å½•"></a>å…¶ä»–é—®é¢˜è®°å½•</h2><h3 id="hashcode-å¯èƒ½ä¸ºè´Ÿæ•°"><a href="#hashcode-å¯èƒ½ä¸ºè´Ÿæ•°" class="headerlink" title="hashcode å¯èƒ½ä¸ºè´Ÿæ•°"></a>hashcode å¯èƒ½ä¸ºè´Ÿæ•°</h3><p>æ•°æ®é‡è¾ƒå¤§çš„åœºæ™¯ä¸‹ï¼Œä¸åŒçš„é•¿é“¾æ¥ç”Ÿæˆçš„ hashcode å¯èƒ½ä¼šé‡å¤ï¼Œè¿›è€Œå¯¼è‡´ç”Ÿæˆçš„çŸ­é“¾æ¥é‡å¤ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨å‘ç°çŸ­é“¾æ¥é‡å¤æ—¶ï¼Œéœ€è¦è¿›è¡Œé‡è¯•ï¼Œæˆ‘é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯å‘ç°é‡å¤æ—¶ç›´æ¥åœ¨åŸå§‹é“¾æ¥åé¢æ‹¼æ¥ä¸€ä¸ªå½“å‰æ—¶é—´æˆ³çš„å‚æ•°ï¼Œå†é‡æ–°ç”Ÿæˆã€‚è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå°±æ˜¯ç”Ÿæˆçš„çŸ­é“¾æ¥ hashcode å¯èƒ½ä¸ºè´Ÿæ•°ï¼Œå¯¼è‡´ base62 è½¬æ¢æ—¶æ•°ç»„è¶Šç•Œã€‚</p>
<p>è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨è¿›è¡Œ base62 è½¬ç æ—¶ï¼Œå…ˆå°†è´Ÿçš„ hashcode è½¬ä¸ºæ­£çš„ã€‚æœ¬æ¥æƒ³ç®€å•ç›´æ¥å–ç»å¯¹å€¼ï¼Œåæ¥å‘ç°æœ‰æ›´å¥½çš„å®ç°æ–¹å¼ï¼šç›´æ¥ç”¨ä½æ“ä½œå»æ‰è´Ÿå·ã€‚å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.cnblogs.com/k-class/p/13773161.html">hashcodeè¿”å›å€¼å¯èƒ½ä¸ºè´Ÿæ•°</a></p>
<pre><code>long hash = key.hashCode() &amp; Integer.MAX_VALUE; // caution, make value not minus
</code></pre>
<h3 id="Async-å¤±æ•ˆé—®é¢˜"><a href="#Async-å¤±æ•ˆé—®é¢˜" class="headerlink" title="@Async å¤±æ•ˆé—®é¢˜"></a>@Async å¤±æ•ˆé—®é¢˜</h3><p>å¼€å‘è¿‡ç¨‹ä¸­æƒ³æŠŠæ¯ä¸ªçŸ­é“¾æ¥è®¿é—®æ¬¡æ•°è®°å½•ä¸‹æ¥ï¼Œäºæ˜¯åˆåŠ äº†ä¸€ä¸ªå­—æ®µï¼švisit_countã€‚æ¯ä¸ªçŸ­é“¾æ¥è¢«è®¿é—®æ—¶å°±å°†æ­¤å€¼åŠ  1ã€‚æƒ³æŠŠæ›´æ–°æ“ä½œæ”¾åœ¨ä¸»åº“ä¸­å¼‚æ­¥å»æ›´æ–°ï¼Œé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>è¿™ç®—æ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ï¼Œå…ˆæ’æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å¯åŠ¨ç±»ä¸Šæ˜¯å¦åŠ äº† @EnableAsync</li>
<li>å¼‚æ­¥æ–¹æ³•çš„è¿”å›å€¼åªèƒ½æ˜¯ void æˆ– Future</li>
<li>æ²¡æœ‰èµ° Spring çš„ä»£ç†ç±»</li>
</ul>
<p>3 ä¸ªé—®é¢˜ä¸­ä¸¤ä¸ª ğŸ˜­</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/YoungLee16/article/details/88398045">Spring boot æ³¨è§£@Asyncæ— æ•ˆ,ä¸èµ·ä½œç”¨</a></p>
<h3 id="Value-å–åˆ°é”™è¯¯çš„é…ç½®å€¼"><a href="#Value-å–åˆ°é”™è¯¯çš„é…ç½®å€¼" class="headerlink" title="@Value å–åˆ°é”™è¯¯çš„é…ç½®å€¼"></a>@Value å–åˆ°é”™è¯¯çš„é…ç½®å€¼</h3><p>é…ç½®ä¸ºï¼š</p>
<pre><code>sys.config.sign-check: ON
</code></pre>
<p>ä½†æ˜¯è°ƒè¯•ä¸­å‘ç°ç¨‹åºä¸­å¯¹åº”çš„å˜é‡å€¼ä¸º trueã€‚å°è¯•å°† ON åˆ é™¤ï¼Œä¿æŒé…ç½®ä¸ºç©ºå†é‡å¯ä¹‹åå‘ç°å–åˆ°çš„å€¼ä¸º nullã€‚æœ€åå°†é…ç½®æ”¹ä¸ºï¼š</p>
<pre><code>sys.config.sign-check: &quot;ON&quot;
</code></pre>
<p>ä¹‹åï¼Œå¯ä»¥æ­£å¸¸è¯»å–åˆ° ON äº†ã€‚</p>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>åŠ è½½è¯„è®ºéœ€è¦åœ¨æµè§ˆå™¨å¯ç”¨ JavaScript è„šæœ¬æ”¯æŒã€‚</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">é¦–é¡µ</a></li>
        
          <li><a href="/archives/">å½’æ¡£</a></li>
        
          <li><a href="/friends/">å‹é“¾</a></li>
        
          <li><a href="/about/">å…³äº</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">å¼€å¾€ ğŸš‡</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80"><span class="toc-number">1.</span> <span class="toc-text">æœåŠ¡åœ°å€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">2.</span> <span class="toc-text">èƒŒæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%B7%E5%80%BC"><span class="toc-number">3.</span> <span class="toc-text">ä»·å€¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">4.</span> <span class="toc-text">éœ€æ±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">åŠŸèƒ½æ€§éœ€æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%8A%9F%E8%83%BD%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-number">4.2.</span> <span class="toc-text">éåŠŸèƒ½æ€§éœ€æ±‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E9%87%8F%E9%A2%84%E6%9C%9F"><span class="toc-number">5.</span> <span class="toc-text">ç³»ç»Ÿæ•°æ®é‡é¢„æœŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88"><span class="toc-number">6.</span> <span class="toc-text">çŸ­é“¾ç”Ÿæˆæ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%A2%9Eid"><span class="toc-number">6.1.</span> <span class="toc-text">è‡ªå¢id</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">æ™®é€šéšæœºæ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hash"><span class="toc-number">6.3.</span> <span class="toc-text">Hash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">7.</span> <span class="toc-text">æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%89%E6%8B%A9"><span class="toc-number">7.1.</span> <span class="toc-text">æ•°æ®åº“é€‰æ‹©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E6%96%B9%E6%A1%88"><span class="toc-number">7.2.</span> <span class="toc-text">åˆ†åº“æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%A1%A8%E6%96%B9%E6%A1%88"><span class="toc-number">7.3.</span> <span class="toc-text">åˆ†è¡¨æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-number">7.4.</span> <span class="toc-text">è¡¨ç»“æ„è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">7.5.</span> <span class="toc-text">åˆ›å»ºè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%88%86%E5%8C%BA%E8%A1%A8%E5%88%9B%E5%BB%BA%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">7.6.</span> <span class="toc-text">å®ç°åˆ†åŒºè¡¨åˆ›å»ºè‡ªåŠ¨åŒ–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">8.</span> <span class="toc-text">æŠ€æœ¯é€‰å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">8.1.</span> <span class="toc-text">æ•°æ®åº“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-number">8.2.</span> <span class="toc-text">åç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">8.3.</span> <span class="toc-text">å‰ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8"><span class="toc-number">8.4.</span> <span class="toc-text">å®¹å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Docker-%E9%83%A8%E7%BD%B2%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.</span> <span class="toc-text">ä½¿ç”¨ Docker éƒ¨ç½²æ•°æ®åº“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E9%83%A8%E7%BD%B2-Postgresql"><span class="toc-number">10.</span> <span class="toc-text">Docker éƒ¨ç½² Postgresql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98"><span class="toc-number">11.</span> <span class="toc-text">ç¼“å­˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-number">12.</span> <span class="toc-text">åç«¯æ¥å£è®¾è®¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.1.</span> <span class="toc-text">çŸ­é“¾ç”Ÿæˆæ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.2.</span> <span class="toc-text">çŸ­é“¾ç»Ÿè®¡æ•°æ®æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E9%93%BE%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">12.3.</span> <span class="toc-text">çŸ­é“¾è®¿é—®æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">13.</span> <span class="toc-text">é«˜å¯ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">13.1.</span> <span class="toc-text">æ•°æ®åº“é«˜å¯ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">13.2.</span> <span class="toc-text">åç«¯æœåŠ¡é«˜å¯ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx-%E9%85%8D%E7%BD%AE"><span class="toc-number">14.</span> <span class="toc-text">nginx é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96"><span class="toc-number">14.1.</span> <span class="toc-text">é•œåƒæ‹‰å–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">14.2.</span> <span class="toc-text">å‡†å¤‡é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">14.3.</span> <span class="toc-text">å¯åŠ¨å®¹å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">15.</span> <span class="toc-text">å‰ç«¯é¡¹ç›®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vue-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">15.1.</span> <span class="toc-text">Vue é¡¹ç›®æ­å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Axios-%E9%85%8D%E7%BD%AE"><span class="toc-number">15.2.</span> <span class="toc-text">Axios é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">15.3.</span> <span class="toc-text">é¡µé¢ä»£ç å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2%E8%87%B3-nginx"><span class="toc-number">15.4.</span> <span class="toc-text">æ‰“åŒ…éƒ¨ç½²è‡³ nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E9%95%9C%E5%83%8F%E7%94%9F%E6%88%90"><span class="toc-number">15.5.</span> <span class="toc-text">Docker é•œåƒç”Ÿæˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Springboot-MyBatis-%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE"><span class="toc-number">16.</span> <span class="toc-text">Springboot + MyBatis å¤šæ•°æ®æºé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">17.</span> <span class="toc-text">Docker éƒ¨ç½²åç«¯æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jar-%E5%8C%85%E7%94%9F%E6%88%90"><span class="toc-number">17.1.</span> <span class="toc-text">jar åŒ…ç”Ÿæˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-%E7%BC%96%E5%86%99"><span class="toc-number">17.2.</span> <span class="toc-text">Dockerfile ç¼–å†™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85"><span class="toc-number">17.3.</span> <span class="toc-text">æ‰“åŒ…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx-%E8%BD%AC%E5%8F%91%E9%85%8D%E7%BD%AE"><span class="toc-number">18.</span> <span class="toc-text">nginx è½¬å‘é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="toc-number">19.</span> <span class="toc-text">é—®é¢˜è®°å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95"><span class="toc-number">20.</span> <span class="toc-text">å…¶ä»–é—®é¢˜è®°å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hashcode-%E5%8F%AF%E8%83%BD%E4%B8%BA%E8%B4%9F%E6%95%B0"><span class="toc-number">20.1.</span> <span class="toc-text">hashcode å¯èƒ½ä¸ºè´Ÿæ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Async-%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98"><span class="toc-number">20.2.</span> <span class="toc-text">@Async å¤±æ•ˆé—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Value-%E5%8F%96%E5%88%B0%E9%94%99%E8%AF%AF%E7%9A%84%E9%85%8D%E7%BD%AE%E5%80%BC"><span class="toc-number">20.3.</span> <span class="toc-text">@Value å–åˆ°é”™è¯¯çš„é…ç½®å€¼</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://lozhu.happy365.day/2024/04/13/7c444bb72964/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li> -->
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&text=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&is_video=false&description=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li> -->
  <li><a class="icon" href="mailto:?subject=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡&body=Check out this article: https://lozhu.happy365.day/2024/04/13/7c444bb72964/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&title=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&name=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li> -->
  <!-- <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://lozhu.happy365.day/2024/04/13/7c444bb72964/&t=åŠ¨æ‰‹å®ç°ä¸€ä¸ªçŸ­é“¾æ¥æœåŠ¡"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li> -->
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    <!-- Copyright --> &copy;
    
    
    2018-2024
    lozhu
  </div>
  
    <div>
      <a href="https://icp.gov.moe/?keyword=20249900" target="_blank">èŒICPå¤‡ 20249900 å·</a>
    </div>
  
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/friends/">å‹é“¾</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html">å¼€å¾€ ğŸš‡</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸï¼");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8bdf047ae0a66729bd3b27e8bb56fe11";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      </script>

<!-- 51la Analytics -->

  <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
  <script>
  LA.init({
      id: '3I0QIERSX42bDzDc',
      ck: '3I0QIERSX42bDzDc'
  })
  </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'lozhu20/my-blog-comments';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-light';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

<!-- image modal -->
<script>
  (function() {
    var contentNode = document.getElementsByClassName('content e-content');
    if (!contentNode || contentNode.length === 0) {
      console.log('no content, exit');
      return;
    }

    var imgsNodes = contentNode[0].getElementsByTagName('img');
    if (!imgsNodes || imgsNodes.length === 0) {
      console.log('no image, exit');
      return;
    }

    var span = document.getElementById('modal_close_btn');
    span.onclick = function() { 
      modal.style.display = "none";
    };

    var modal = document.getElementById('modal');
    var modalImage = document.getElementById('modal_image');
    var captionText = document.getElementById('caption');

    for (var i = imgsNodes.length - 1; i >= 0; i--) {
      let image = imgsNodes[i];
      image.onclick = function() {
        modal.style.display = "block";
        modalImage.src = this.src;
        captionText.innerHTML = this.alt || "æ–‡ç« é…å›¾";
      };
    }
  }());
</script>

</body>
</html>
